<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>WMS 시스템</title>
  <!-- Tailwind CSS -->
  <script src="https://cdn.tailwindcss.com"></script>
  <!-- TUI Grid -->
  <link rel="stylesheet" href="https://uicdn.toast.com/grid/latest/tui-grid.css">
  <script src="https://uicdn.toast.com/grid/latest/tui-grid.js"></script>
  <!-- ApexCharts -->
  <script src="https://cdn.jsdelivr.net/npm/apexcharts"></script>
  <style>
    .hidden { display: none; }
    .active-tab { background-color: #2563eb; color: #facc15; }
  </style>
</head>
<body class="bg-gray-100 h-screen w-screen flex items-center justify-center">
  <div id="root" class="bg-white shadow-lg rounded-lg w-full max-w-6xl h-full overflow-auto"></div>

  <script>
    document.addEventListener('DOMContentLoaded', () => {
      // 샘플 데이터 생성
      const generateSampleData = (action, count = 20) => {
        const titles = [
          "The Great Gatsby", "To Kill a Mockingbird", "1984", "Pride and Prejudice",
          "The Catcher in the Rye", "Moby-Dick", "War and Peace", "The Hobbit",
          "Crime and Punishment", "Harry Potter and the Sorcerer's Stone"
        ];
        const sampleData = [];
        for (let i = 0; i < count; i++) {
          sampleData.push({
            id: i + 1,
            date: `2025-01-${String(i % 31 + 1).padStart(2, '0')}`,
            action: action,
            title: titles[i % titles.length],
            quantity: Math.floor(Math.random() * 100) + 1
          });
        }
        return sampleData;
      };

      // 2024년 월별 출고 데이터 생성
      const generateMonthlyOutboundData = () => {
        const months = Array.from({ length: 12 }, (_, i) => `${i + 1}월`);
        return months.map(month => ({
          month: month,
          quantity: Math.floor(Math.random() * 500) + 50
        }));
      };

      // 데이터 초기화
      const data = {
        inbound: generateSampleData("입고"),
        outbound: generateSampleData("출고"),
        stock: [
          { title: "The Great Gatsby", quantity: 50 },
          { title: "To Kill a Mockingbird", quantity: 30 },
          { title: "1984", quantity: 20 }
        ],
        monthlyOutbound: generateMonthlyOutboundData()
      };

      // Root Container
      const root = document.getElementById('root');

      // Tabs
      const tabs = [
        { id: 'tab-inbound', name: '입고 관리' },
        { id: 'tab-outbound', name: '출고 관리' },
        { id: 'tab-dashboard', name: '대시보드' }
      ];

      const tabContainer = document.createElement('div');
      tabContainer.className = 'flex border-b';
      root.appendChild(tabContainer);

      const sections = {};

      tabs.forEach(tab => {
        const tabButton = document.createElement('button');
        tabButton.id = tab.id;
        tabButton.className = 'flex-1 py-2 text-center text-gray-600 hover:bg-gray-100';
        tabButton.innerText = tab.name;
        tabContainer.appendChild(tabButton);

        const section = document.createElement('div');
        section.id = `${tab.id}-section`;
        section.className = 'p-6 hidden';
        root.appendChild(section);
        sections[tab.id] = section;
      });

      // 기본 탭
      sections['tab-inbound'].classList.remove('hidden');
      document.getElementById('tab-inbound').classList.add('active-tab');

      // Populate Sections
      populateInbound(sections['tab-inbound']);
      populateOutbound(sections['tab-outbound']);
      populateDashboard(sections['tab-dashboard']);

      // Tab Switching
      tabs.forEach(tab => {
        document.getElementById(tab.id).addEventListener('click', () => {
          tabs.forEach(t => {
            sections[t.id].classList.add('hidden');
            document.getElementById(t.id).classList.remove('active-tab');
          });
          sections[tab.id].classList.remove('hidden');
          document.getElementById(tab.id).classList.add('active-tab');
        });
      });

      // Populate Inbound
      function populateInbound(section) {
        section.innerHTML = `
          <h2 class="text-xl font-bold mb-4">입고 관리</h2>
          <div id="inbound-grid" class="mt-4"></div>
        `;

        const grid = new tui.Grid({
          el: document.getElementById('inbound-grid'),
          data: data.inbound,
          columns: [
            { header: 'ID', name: 'id', width: 50, align: 'center', editor: 'text' },
            { header: '날짜', name: 'date', align: 'center', editor: 'text' },
            { header: '도서명', name: 'title', align: 'center', editor: 'text' },
            { header: '수량', name: 'quantity', align: 'center', editor: 'text' }
          ],
          rowHeaders: ['checkbox'],
          copyOptions: { useFormattedValue: true },
          editable: true
        });

        addGridToolbar(section, grid, 'inbound');
      }

      // Populate Outbound
      function populateOutbound(section) {
        section.innerHTML = `
          <h2 class="text-xl font-bold mb-4">출고 관리</h2>
          <div id="outbound-grid" class="mt-4"></div>
        `;

        const grid = new tui.Grid({
          el: document.getElementById('outbound-grid'),
          data: data.outbound,
          columns: [
            { header: 'ID', name: 'id', width: 50, align: 'center', editor: 'text' },
            { header: '날짜', name: 'date', align: 'center', editor: 'text' },
            { header: '도서명', name: 'title', align: 'center', editor: 'text' },
            { header: '수량', name: 'quantity', align: 'center', editor: 'text' }
          ],
          rowHeaders: ['checkbox'],
          copyOptions: { useFormattedValue: true },
          editable: true
        });

        addGridToolbar(section, grid, 'outbound');
      }

      // Add Toolbar for CRUD Operations
      function addGridToolbar(section, grid, type) {
        const toolbar = document.createElement('div');
        toolbar.className = 'flex justify-end gap-2 mt-4';

        const addButton = document.createElement('button');
        addButton.className = 'bg-blue-500 text-white py-2 px-4 rounded hover:bg-blue-600';
        addButton.innerText = '추가';
        addButton.addEventListener('click', () => {
          grid.appendRow({ id: grid.getRowCount() + 1, date: '', title: '', quantity: 0 });
        });

        const deleteButton = document.createElement('button');
        deleteButton.className = 'bg-red-500 text-white py-2 px-4 rounded hover:bg-red-600';
        deleteButton.innerText = '삭제';
        deleteButton.addEventListener('click', () => {
          const checkedRows = grid.getCheckedRows();
          const idsToDelete = checkedRows.map(row => row.id);
          grid.removeCheckedRows();
          data[type] = data[type].filter(row => !idsToDelete.includes(row.id));
        });

        toolbar.appendChild(addButton);
        toolbar.appendChild(deleteButton);
        section.appendChild(toolbar);
      }

      // Populate Dashboard
      function populateDashboard(section) {
        section.innerHTML = `
          <h2 class="text-xl font-bold mb-4">대시보드</h2>
          <div id="stock-chart" class="mb-8"></div>
          <div id="monthly-outbound-chart"></div>
        `;

        // 도서 재고 파이 차트
        const pieOptions = {
          chart: {
            type: 'pie',
            height: 350
          },
          series: data.stock.map(item => item.quantity),
          labels: data.stock.map(item => item.title),
          title: {
            text: '도서 재고 현황',
            align: 'center'
          },
          colors: ['#3b82f6', '#10b981', '#f43f5e', '#fbbf24', '#8b5cf6']
        };

        const pieChart = new ApexCharts(document.querySelector("#stock-chart"), pieOptions);
        pieChart.render();

        // 월별 출고 추이 라인 차트
        const lineOptions = {
          chart: {
            type: 'line',
            height: 350
          },
          series: [{
            name: '월별 출고량',
            data: data.monthlyOutbound.map(item => item.quantity)
          }],
          xaxis: {
            categories: data.monthlyOutbound.map(item => item.month)
          },
          title: {
            text: '2024년 월별 출고 추이',
            align: 'center'
          },
          colors: ['#2563eb']
        };

        const lineChart = new ApexCharts(document.querySelector("#monthly-outbound-chart"), lineOptions);
        lineChart.render();
      }
    });
  </script>
</body>
</html>
