<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Attendance Management</title>
  <!-- Tailwind CSS -->
  <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
</head>
<body class="bg-gray-100 text-gray-900">

  <div class="container mx-auto p-4">
    <h1 class="text-3xl font-bold mb-4">Attendance Management</h1>

    <div class="flex items-center mb-4">
      <div class="mr-4">
        <label for="departmentSelect" class="block text-sm font-medium text-gray-700">Department:</label>
        <select id="departmentSelect" onchange="updateEmployeeSelect()" class="mt-1 block pl-3 pr-10 py-2 text-base border-gray-300 focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm rounded-md">
          <!-- Department options will be inserted here -->
        </select>
      </div>

      <div class="mr-4">
        <label for="employeeSelect" class="block text-sm font-medium text-gray-700">Employee:</label>
        <select id="employeeSelect" onchange="showAttendance()" class="mt-1 block pl-3 pr-10 py-2 text-base border-gray-300 focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm rounded-md">
          <!-- Employee options will be inserted here -->
        </select>
      </div>
    </div>

    <div class="table-container overflow-x-auto">
      <table id="attendanceTable" class="min-w-full bg-white shadow-md rounded-lg overflow-hidden">
        <thead class="bg-gray-800 text-white">
          <tr id="dateRow">
            <th class="px-6 py-3 text-left text-xs font-medium uppercase tracking-wider">Employee Name</th>
            <!-- Dates will be inserted here -->
          </tr>
        </thead>
        <tbody id="attendanceBody" class="bg-white divide-y divide-gray-200">
          <!-- Attendance records will be inserted here -->
        </tbody>
      </table>
    </div>
  </div>

  <script>
    const attendanceData = [
      {
        department: "Engineering",
        title: "Software Engineer",
        name: "John Doe",
        employeeId: "E1234",
        attendance: [
          { date: "2025-01-01", checkIn: "09:00", checkOut: "18:00" },
          { date: "2025-01-02", checkIn: "09:15", checkOut: "18:05" },
          { date: "2025-01-03", checkIn: "09:10", checkOut: "18:10" }
        ]
      },
      {
        department: "HR",
        title: "HR Manager",
        name: "Jane Smith",
        employeeId: "H5678",
        attendance: [
          { date: "2025-01-01", checkIn: "08:45", checkOut: "17:45" },
          { date: "2025-01-02", checkIn: "09:00", checkOut: "18:00" },
          { date: "2025-01-03", checkIn: "09:05", checkOut: "18:15" }
        ]
      }
    ];

    class AttendanceManager {
      constructor(data) {
        this.data = data;
      }

      getAttendance(employeeId) {
        if (employeeId === "ALL") {
          return this.data;
        } else {
          const employee = this.data.find(emp => emp.employeeId === employeeId);
          if (!employee) {
            console.log(`Employee with ID ${employeeId} not found.`);
            return [];
          }
          return [employee];
        }
      }
    }

    const manager = new AttendanceManager(attendanceData);

    // Populate department select box
    const departmentSelect = document.getElementById('departmentSelect');
    const departments = [...new Set(attendanceData.map(employee => employee.department))];
    departments.forEach(department => {
      const option = document.createElement('option');
      option.value = department;
      option.text = department;
      departmentSelect.appendChild(option);
    });

    // Populate employee select box based on department
    function updateEmployeeSelect() {
      const selectedDepartment = departmentSelect.value;
      const employeeSelect = document.getElementById('employeeSelect');
      employeeSelect.innerHTML = ''; // Clear previous options

      const employeesInDepartment = attendanceData.filter(employee => employee.department === selectedDepartment);
      employeesInDepartment.forEach(employee => {
        const option = document.createElement('option');
        option.value = employee.employeeId;
        option.text = `${employee.name} (${employee.employeeId})`;
        employeeSelect.appendChild(option);
      });

      // Automatically show attendance for the first employee in the list
      if (employeesInDepartment.length > 0) {
        employeeSelect.value = employeesInDepartment[0].employeeId;
        showAttendance();
      }
    }

    function getLastDayOfMonth(year, month) {
      return new Date(year, month, 0).getDate();
    }

    function showAttendance() {
      const employeeId = document.getElementById('employeeSelect').value;
      const today = new Date().toISOString().split('T')[0]; // Get today's date in YYYY-MM-DD format

      const employeesAttendance = manager.getAttendance(employeeId);
      const dateRow = document.getElementById('dateRow');
      const attendanceBody = document.getElementById('attendanceBody');
      dateRow.innerHTML = '<th class="px-6 py-3 text-left text-xs font-medium uppercase tracking-wider">Employee Name</th>'; // Clear previous dates
      attendanceBody.innerHTML = ''; // Clear previous content

      // Insert dates in the header
      const allDates = new Set();
      employeesAttendance.forEach(employee => {
        employee.attendance.forEach(record => {
          allDates.add(record.date);
        });
      });
      const sortedDates = Array.from(allDates).sort();
      sortedDates.forEach(dateStr => {
        const dateCell = document.createElement('th');
        dateCell.className = `px-6 py-3 text-left text-xs font-medium uppercase tracking-wider ${dateStr === today ? 'text-blue-600 font-bold' : ''}`;
        dateCell.textContent = dateStr;
        dateRow.appendChild(dateCell);
      });

      // Insert attendance data for each employee
      employeesAttendance.forEach(employee => {
        const employeeNameCell = document.createElement('td');
        employeeNameCell.className = 'px-6 py-4 whitespace-nowrap';
        employeeNameCell.textContent = employee.name;
        const row = document.createElement('tr');
        row.className = 'hover:bg-gray-100';
        row.appendChild(employeeNameCell);

        sortedDates.forEach(dateStr => {
          const record = employee.attendance.find(rec => rec.date === dateStr);
          const attendanceCell = document.createElement('td');
          attendanceCell.className = `px-6 py-4 whitespace-nowrap ${dateStr === today ? 'text-blue-600 font-bold' : ''}`;
          if (record) {
            attendanceCell.innerHTML = `
              <div>Check-In: <span class="${record.checkIn > '09:00' ? 'text-red-500' : ''}">${record.checkIn}</span></div>
              <div>Check-Out: <span class="${record.checkOut > '18:00' ? 'text-orange-500' : ''}">${record.checkOut}</span></div>
            `;
          } else {
            attendanceCell.innerHTML = '-';
          }
          row.appendChild(attendanceCell);
        });

        attendanceBody.appendChild(row);
      });
    }

    // Automatically populate employee select box and show attendance on load
    window.onload = () => {
      updateEmployeeSelect();
    };
  </script>

</body>
</html>