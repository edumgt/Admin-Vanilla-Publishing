<!DOCTYPE html>
<html lang="ko">

<head>
  <meta charset="UTF-8">
  <title>Mpeg</title>

  <!-- Tailwind -->
  <script src="https://cdn.tailwindcss.com"></script>
  <!-- Chart.js -->
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

  <!-- ê¸°ë³¸ CSS -->
  <link href="assets/css/default.css" rel="stylesheet">
  
</head>

<body class="bg-gray-50 w-full h-full">
  <!-- ê³µí†µ ìƒë‹¨/ì¢Œì¸¡ ë©”ë‰´ -->
  <div id="cmmContainer"></div>
  <div id="tnbContainer"></div>
  <div id="lnbContainer"></div>

  <!-- ë©”ì¸ ì½˜í…ì¸  -->
  <div id="content" class="ml-[110px] pt-24 px-10">
    <nav class="breadcrumb text-lg font-semibold text-gray-700">ë™ì˜ìƒ ë¶„ì„</nav>

    <!-- íŒŒì¼ ì—…ë¡œë“œ -->
    <div id="uploadBox"
      class="border-2 border-dashed border-gray-400 rounded-lg p-10 text-center text-gray-500 cursor-pointer hover:border-blue-500 hover:bg-blue-50 transition mt-6">
      ğŸ¬ Drag & Drop ë˜ëŠ” í´ë¦­í•˜ì—¬ ì˜ìƒ ì—…ë¡œë“œ
      <input type="file" id="fileInput" accept="video/mp4" hidden />
    </div>

    <!-- ë¶„ì„ ì˜ì—­ -->
    <div class="flex gap-6 mt-8">
      <!-- ì¢Œì¸¡: ë™ì˜ìƒ -->
      <div class="flex-[1.2] max-w-[600px]">
        <div class="w-full aspect-video bg-gray-200 border border-gray-300 rounded-lg shadow relative overflow-hidden">
          <video id="videoPlayer"
            class="w-full h-full object-contain bg-black"
            controls>
            ë¸Œë¼ìš°ì €ê°€ video íƒœê·¸ë¥¼ ì§€ì›í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.
          </video>
          <!-- placeholder -->
          <div id="videoPlaceholder"
            class="absolute inset-0 flex items-center justify-center text-gray-500 text-sm bg-gray-200">
            ì•„ì§ ì—…ë¡œë“œëœ ì˜ìƒì´ ì—†ìŠµë‹ˆë‹¤
          </div>
        </div>
      </div>

      <!-- ìš°ì¸¡: ë¶„ì„ ê²°ê³¼ + ì°¨íŠ¸ -->
      <div class="flex-[2] flex flex-col justify-start w-full">
        <div id="result" class="text-lg mb-4">
          íŒë³„ ê²°ê³¼: <span id="verdict" class="font-semibold text-gray-800">-</span><br />
          ì‹ ë¢°ë„ ì ìˆ˜: <span id="confidence" class="font-bold text-blue-600">-</span>
        </div>

        <div id="chart-container" class="w-full h-[420px] bg-white rounded-lg shadow p-8">
          <div class="flex justify-between items-center mb-2">
            <span class="font-semibold text-gray-700">í”„ë ˆì„ë³„ Confidence Score</span>
            <button id="toggleChartBtn"
              class="px-3 py-1 text-sm rounded bg-blue-500 text-white hover:bg-blue-600 transition">
              Bar ì°¨íŠ¸ë¡œ ë³´ê¸°
            </button>
          </div>
          <canvas id="frameChart"></canvas>
        </div>
      </div>
    </div>
  </div>

  <!-- ê³µí†µ JS -->
  <script type="module" src="assets/js/logomodule.js"></script>

  <script>
    const fileInput = document.getElementById("fileInput");
    const uploadBox = document.getElementById("uploadBox");
    const videoPlayer = document.getElementById("videoPlayer");
    const videoPlaceholder = document.getElementById("videoPlaceholder");
    const verdictEl = document.getElementById("verdict");
    const confidenceEl = document.getElementById("confidence");
    const ctx = document.getElementById("frameChart").getContext("2d");
    const toggleChartBtn = document.getElementById("toggleChartBtn");

    let currentType = "line";

    // Chart ì´ˆê¸°í™”
    let frameChart = new Chart(ctx, {
      type: currentType,
      data: {
        labels: [],
        datasets: [{
          label: "Frame Confidence Score",
          data: [],
          borderColor: "#3B82F6",
          backgroundColor: "rgba(59,130,246,0.4)",
          borderWidth: 2,
          pointRadius: 4,
          pointBackgroundColor: "#2563EB",
          tension: 0.35
        }]
      },
      options: {
        responsive: true,
        maintainAspectRatio: false,
        plugins: { legend: { position: "top" } },
        scales: {
          y: { min: 0, max: 1, ticks: { stepSize: 0.1 } }
        }
      }
    });

    // ì°¨íŠ¸ íƒ€ì… í† ê¸€
    toggleChartBtn.addEventListener("click", () => {
      currentType = currentType === "line" ? "bar" : "line";
      const chartData = JSON.parse(JSON.stringify(frameChart.data));
      const chartOptions = JSON.parse(JSON.stringify(frameChart.options));
      frameChart.destroy();
      frameChart = new Chart(ctx, { type: currentType, data: chartData, options: chartOptions });
      toggleChartBtn.textContent =
        currentType === "line" ? "Bar ì°¨íŠ¸ë¡œ ë³´ê¸°" : "Line ì°¨íŠ¸ë¡œ ë³´ê¸°";
    });

    // ì—…ë¡œë“œ ì´ë²¤íŠ¸
    uploadBox.addEventListener("click", () => fileInput.click());
    uploadBox.addEventListener("dragover", (e) => {
      e.preventDefault();
      uploadBox.classList.add("bg-blue-50", "border-blue-500");
    });
    uploadBox.addEventListener("dragleave", () => {
      uploadBox.classList.remove("bg-blue-50", "border-blue-500");
    });
    uploadBox.addEventListener("drop", (e) => {
      e.preventDefault();
      uploadBox.classList.remove("bg-blue-50", "border-blue-500");
      handleFile(e.dataTransfer.files[0]);
    });
    fileInput.addEventListener("change", (e) => handleFile(e.target.files[0]));

    // íŒŒì¼ í•¸ë“¤ëŸ¬
    function handleFile(file) {
      if (!file) return;

      // ë™ì˜ìƒ ë¯¸ë¦¬ë³´ê¸°
      const videoURL = URL.createObjectURL(file);
      videoPlayer.src = videoURL;
      videoPlaceholder.classList.add("hidden");

      // Mock ê²°ê³¼
      const randomConfidence = Math.random();
      verdictEl.textContent = randomConfidence > 0.5 ? "Fake" : "Real";
      confidenceEl.textContent = (randomConfidence * 100).toFixed(2) + "%";

      const scores = Array.from({ length: 30 }, () => Math.random());
      const labels = scores.map((_, i) => `Frame ${i + 1}`);
      frameChart.data.labels = labels;
      frameChart.data.datasets[0].data = scores;
      frameChart.update();
    }
  </script>
</body>
</html>
