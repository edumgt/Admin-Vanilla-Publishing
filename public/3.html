<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>KSNVE 용어사전 - 페이징 예시</title>

  <!-- Tailwind가 아닌 다른 CSS를 사용한다고 가정하므로, 예시로 넣지 않았습니다.
       필요하다면 Tailwind CDN 혹은 별도 CSS를 import 하세요. -->
  <link rel="stylesheet" href="assets/css/default.css">
</head>
<body class="bg-gray-100">

  <!-- 헤더 영역 -->
  <header class="max-w-3xl mx-auto p-4">
    <h1 class="text-2xl font-extrabold mb-2">KSNVE 용어사전 (페이징 예시)</h1>
    <p class="text-gray-600">
      - 영어(en), 한글(ko), 설명(desc) 구조<br/>
      - 부분 검색 + ㄱㄴㄷ / A B C 필터 + <strong>20개씩 페이징</strong> + 검색 결과 건수 표기
    </p>
  </header>

  <!-- 메인 영역 -->
  <main class="max-w-3xl mx-auto p-4">
    <!-- 검색 영역 -->
    <div class="mb-4 relative">
      <!-- 검색 입력 (돋보기 아이콘은 오른쪽) -->
      <input
        type="text"
        id="searchInput"
        placeholder="검색어(음절) 입력..."
        aria-label="용어사전 검색"
        class="w-full h-12 pl-4 pr-10 border border-gray-300 rounded focus:outline-none focus:ring-2 focus:ring-blue-500"
      />
      <!-- 예시 돋보기 아이콘 (오른쪽) -->
      <svg
        class="w-5 h-5 text-gray-400 absolute"
        style="right: 1rem; top: 50%; transform: translateY(-50%); pointer-events: none;"
        fill="none"
        stroke="currentColor"
        stroke-width="2"
        viewBox="0 0 24 24"
        aria-hidden="true"
      >
        <path
          stroke-linecap="round"
          stroke-linejoin="round"
          d="M21 21l-4-4m0 0A7 7 0 1110 10a7 7 0 017 7z"
        />
      </svg>
    </div>

    <!-- 검색 결과 건수 표기 -->
    <div id="searchCount" class="text-gray-600 mb-4"></div>

    <!-- 초성/알파벳 버튼들 -->
    <div class="flex flex-wrap gap-2 mb-6">
      <!-- 한글 초성 -->
      <button class="filter-btn py-1 px-2 bg-white border rounded" data-initial="ㄱ">ㄱ</button>
      <button class="filter-btn py-1 px-2 bg-white border rounded" data-initial="ㄴ">ㄴ</button>
      <button class="filter-btn py-1 px-2 bg-white border rounded" data-initial="ㄷ">ㄷ</button>
      <button class="filter-btn py-1 px-2 bg-white border rounded" data-initial="ㄹ">ㄹ</button>
      <button class="filter-btn py-1 px-2 bg-white border rounded" data-initial="ㅁ">ㅁ</button>
      <button class="filter-btn py-1 px-2 bg-white border rounded" data-initial="ㅂ">ㅂ</button>
      <button class="filter-btn py-1 px-2 bg-white border rounded" data-initial="ㅅ">ㅅ</button>
      <button class="filter-btn py-1 px-2 bg-white border rounded" data-initial="ㅇ">ㅇ</button>
      <button class="filter-btn py-1 px-2 bg-white border rounded" data-initial="ㅈ">ㅈ</button>
      <button class="filter-btn py-1 px-2 bg-white border rounded" data-initial="ㅊ">ㅊ</button>
      <button class="filter-btn py-1 px-2 bg-white border rounded" data-initial="ㅋ">ㅋ</button>
      <button class="filter-btn py-1 px-2 bg-white border rounded" data-initial="ㅌ">ㅌ</button>
      <button class="filter-btn py-1 px-2 bg-white border rounded" data-initial="ㅍ">ㅍ</button>
      <button class="filter-btn py-1 px-2 bg-white border rounded" data-initial="ㅎ">ㅎ</button>

      <!-- 알파벳 (A~Z) -->
      <button class="filter-btn py-1 px-2 bg-white border rounded" data-initial="A">A</button>
      <button class="filter-btn py-1 px-2 bg-white border rounded" data-initial="B">B</button>
      <button class="filter-btn py-1 px-2 bg-white border rounded" data-initial="C">C</button>
      <button class="filter-btn py-1 px-2 bg-white border rounded" data-initial="D">D</button>
      <button class="filter-btn py-1 px-2 bg-white border rounded" data-initial="E">E</button>
      <button class="filter-btn py-1 px-2 bg-white border rounded" data-initial="F">F</button>
      <button class="filter-btn py-1 px-2 bg-white border rounded" data-initial="G">G</button>
      <button class="filter-btn py-1 px-2 bg-white border rounded" data-initial="H">H</button>
      <button class="filter-btn py-1 px-2 bg-white border rounded" data-initial="I">I</button>
      <button class="filter-btn py-1 px-2 bg-white border rounded" data-initial="J">J</button>
      <button class="filter-btn py-1 px-2 bg-white border rounded" data-initial="K">K</button>
      <button class="filter-btn py-1 px-2 bg-white border rounded" data-initial="L">L</button>
      <button class="filter-btn py-1 px-2 bg-white border rounded" data-initial="M">M</button>
      <button class="filter-btn py-1 px-2 bg-white border rounded" data-initial="N">N</button>
      <button class="filter-btn py-1 px-2 bg-white border rounded" data-initial="O">O</button>
      <button class="filter-btn py-1 px-2 bg-white border rounded" data-initial="P">P</button>
      <button class="filter-btn py-1 px-2 bg-white border rounded" data-initial="Q">Q</button>
      <button class="filter-btn py-1 px-2 bg-white border rounded" data-initial="R">R</button>
      <button class="filter-btn py-1 px-2 bg-white border rounded" data-initial="S">S</button>
      <button class="filter-btn py-1 px-2 bg-white border rounded" data-initial="T">T</button>
      <button class="filter-btn py-1 px-2 bg-white border rounded" data-initial="U">U</button>
      <button class="filter-btn py-1 px-2 bg-white border rounded" data-initial="V">V</button>
      <button class="filter-btn py-1 px-2 bg-white border rounded" data-initial="W">W</button>
      <button class="filter-btn py-1 px-2 bg-white border rounded" data-initial="X">X</button>
      <button class="filter-btn py-1 px-2 bg-white border rounded" data-initial="Y">Y</button>
      <button class="filter-btn py-1 px-2 bg-white border rounded" data-initial="Z">Z</button>
    </div>

    <!-- 실제 용어사전 목록 표시 (카드형) -->
    <dl
      id="glossary"
      aria-label="용어사전 목록"
      role="list"
      class="grid grid-cols-1 sm:grid-cols-2 gap-4"
    ></dl>

    <!-- 페이징 영역: Prev / Next 버튼 -->
    <div id="pagination" class="mt-4 flex items-center gap-4">
      <button id="prevBtn" class="border rounded py-1 px-3">이전</button>
      <button id="nextBtn" class="border rounded py-1 px-3">다음</button>
    </div>
  </main>

  <script>
    /* ------------ (1) 한글 초성 추출 로직 ------------ */
    const CHOSEONG_LIST = [
      "ㄱ","ㄲ","ㄴ","ㄷ","ㄸ","ㄹ","ㅁ",
      "ㅂ","ㅃ","ㅅ","ㅆ","ㅇ","ㅈ","ㅉ",
      "ㅊ","ㅋ","ㅌ","ㅍ","ㅎ"
    ];
    function getHangulInitial(str) {
      if (!str || typeof str !== "string") return "";
      const firstChar = str.trim().charAt(0);
      const code = firstChar.charCodeAt(0) - 0xAC00;
      // '가'(AC00) ~ '힣'(D7A3) 범위 밖이면 빈 문자열
      if (code < 0 || code > 11172) return "";
      const choseongIndex = Math.floor(code / (21 * 28));
      return CHOSEONG_LIST[choseongIndex] || "";
    }

    /* ------------ (2) 전역 변수 -------------- */
    let glossaryData = [];   // 전체 JSON 데이터
    let filteredData = [];   // 현재 필터된 결과 (검색/초성)
    let currentPage = 1;     // 현재 페이지
    const PAGE_SIZE = 20;    // 한 페이지에 보여줄 개수
    let totalPages = 1;      // 총 페이지 수

    /* ------------ (3) 렌더링 함수 (카드 출력) ------------- */
    function renderGlossaryList(data) {
      const glossary = document.getElementById("glossary");
      glossary.innerHTML = "";

      data.forEach(item => {
        // 카드 <div>
        const card = document.createElement("div");
        // 아래 클래스들은 예시로 가볍게 지정.
        // default.css 또는 Tailwind로 원하는 스타일을 적용하세요.
        card.className = "p-4 bg-white rounded shadow-sm hover:shadow-lg transition-shadow duration-200";
        card.setAttribute("role", "listitem");

        // 영어(en)
        const dtEn = document.createElement("dt");
        dtEn.textContent = item.en;
        dtEn.className = "text-xl font-bold text-blue-600 mb-1";

        // 한글(ko)
        const dtKo = document.createElement("dt");
        dtKo.textContent = item.ko;
        dtKo.className = "text-lg text-gray-700 mb-2";

        // 설명(desc)
        const ddDesc = document.createElement("dd");
        ddDesc.textContent = item.desc;
        ddDesc.className = "text-gray-600 leading-snug";

        card.appendChild(dtEn);
        card.appendChild(dtKo);
        card.appendChild(ddDesc);

        glossary.appendChild(card);
      });
    }

    /* ------------ (4) 페이지 표시에 따라 실제 목록 출력 ------------- */
    function displayPage(pageNum) {
      // 현재 페이지 범위 체크
      if (pageNum < 1) pageNum = 1;
      else if (pageNum > totalPages) pageNum = totalPages;
      currentPage = pageNum;

      // pageNum에 해당하는 slice 범위
      const startIndex = (currentPage - 1) * PAGE_SIZE;
      const endIndex = startIndex + PAGE_SIZE;
      const pageData = filteredData.slice(startIndex, endIndex);

      // 렌더링
      renderGlossaryList(pageData);

      // 건수 표시
      const countEl = document.getElementById("searchCount");
      countEl.textContent = `검색 결과: ${filteredData.length}건 (페이지 ${currentPage}/${totalPages})`;

      // 이전/다음 버튼 활성/비활성
      document.getElementById("prevBtn").disabled = currentPage === 1;
      document.getElementById("nextBtn").disabled = currentPage === totalPages || totalPages === 0;
    }

    /* ------------ (5) 검색 (부분 문자열 검색) ------------ */
    function handleSearchInput(e) {
      const val = e.target.value.toLowerCase();

      if (!val) {
        // 입력 없으면 전체
        filteredData = glossaryData;
      } else {
        // en, ko, desc 중 하나라도 val를 포함하면 필터
        filteredData = glossaryData.filter(item => {
          const en = item.en.toLowerCase();
          const ko = item.ko.toLowerCase();
          const desc = item.desc.toLowerCase();
          return en.includes(val) || ko.includes(val) || desc.includes(val);
        });
      }

      // 페이지 계산 후 1페이지부터 다시 표시
      totalPages = Math.ceil(filteredData.length / PAGE_SIZE);
      if (totalPages < 1) totalPages = 1;
      currentPage = 1;
      displayPage(currentPage);
    }

    /* ------------ (6) 초성/알파벳 버튼 필터 ------------- */
    function handleInitialClick(e) {
      const clickedInitial = e.target.dataset.initial;
      if (!clickedInitial) return;

      // 검색창 초기화
      document.getElementById("searchInput").value = "";

      // ㄱㄴㄷ vs A B C
      const isKoreanInitial = /[ㄱ-ㅎ]/.test(clickedInitial);

      if (isKoreanInitial) {
        // ko 필드 첫 글자 초성과 비교
        filteredData = glossaryData.filter(item => {
          const koInitial = getHangulInitial(item.ko);
          return koInitial === clickedInitial;
        });
      } else {
        // en 필드 첫 글자 (대소문자 구분X)와 비교
        filteredData = glossaryData.filter(item => {
          const firstEn = item.en.trim().charAt(0).toLowerCase();
          return firstEn === clickedInitial.toLowerCase();
        });
      }

      // 페이지 계산 후 첫 페이지부터
      totalPages = Math.ceil(filteredData.length / PAGE_SIZE);
      if (totalPages < 1) totalPages = 1;
      currentPage = 1;
      displayPage(currentPage);
    }

    /* ------------ (7) Prev / Next 버튼 ------------- */
    function goPrevPage() {
      if (currentPage > 1) {
        displayPage(currentPage - 1);
      }
    }
    function goNextPage() {
      if (currentPage < totalPages) {
        displayPage(currentPage + 1);
      }
    }

    /* ------------ (8) 초기화 (fetch) ------------- */
    (function init() {
      // 버튼 클릭 이벤트
      document.querySelectorAll(".filter-btn").forEach(btn => {
        btn.addEventListener("click", handleInitialClick);
      });
      // 검색창 이벤트
      document.getElementById("searchInput").addEventListener("input", handleSearchInput);

      // Prev / Next 버튼
      document.getElementById("prevBtn").addEventListener("click", goPrevPage);
      document.getElementById("nextBtn").addEventListener("click", goNextPage);

      // JSON 가져오기
      fetch("/assets/mock/glos.json")
        .then(res => res.json())
        .then(data => {
          // 전역 변수에 저장
          glossaryData = data;
          // 초기에 전체 데이터를 필터 결과로 가정
          filteredData = glossaryData;

          // 페이지 계산
          totalPages = Math.ceil(filteredData.length / PAGE_SIZE);
          currentPage = 1;

          // 초기 표시
          displayPage(currentPage);
        })
        .catch(err => console.error("JSON 불러오기 실패:", err));
    })();
  </script>
</body>
</html>
