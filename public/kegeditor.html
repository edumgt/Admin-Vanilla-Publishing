<!DOCTYPE html>
<html lang="ko">

<head>
  <meta charset="UTF-8">
  <title>Toast UI Editor with Image Resize</title>

  <!-- 기본 스타일 -->
  <link href="assets/css/default.css" rel="stylesheet">

  <!-- Toast UI Editor v2 CDN (정확히 로딩) -->
  <link rel="stylesheet" href="https://uicdn.toast.com/editor/latest/toastui-editor.min.css" />
  <script src="https://uicdn.toast.com/editor/latest/toastui-editor-all.min.js"></script>

  <!-- Interact.js for image resize -->
  <script src="https://cdn.jsdelivr.net/npm/interactjs/dist/interact.min.js"></script>

  <style>
    .resizable-image {
      display: block;
      max-width: 100%;
    }

    .resizable-image.resizing {
      outline: 2px dashed #1E90FF;
    }
  </style>
</head>

<body>
  <div id="cmmContainer"></div>
  <nav class="breadcrumb"></nav>

  <div id="content" style="display: flex; gap: 20px;">
    <div id="grid-left" class="ag-theme-alpine" style="height: 300px; flex: 1;"></div>
    <div id="grid-right" class="ag-theme-alpine" style="height: 300px; flex: 1;"></div>
  </div>

  <!-- 에디터 영역 -->
  <div id="editor" style="margin-top: 30px;"></div>

  <script>
    const editor = new toastui.Editor({
      el: document.querySelector('#editor'),
      height: '500px',
      initialEditType: 'wysiwyg',
      previewStyle: 'vertical',
      toolbar: [
        ['heading', 'bold', 'italic', 'strike'],
        ['hr', 'quote'],
        ['ul', 'ol', 'task'],
        ['table', 'image', 'link']
      ],
      hooks: {
        addImageBlobHook: (blob, callback) => {
          const reader = new FileReader();
          reader.onload = () => {
            const imageUrl = reader.result;
            const html = `<img src="${imageUrl}" class="resizable-image" style="width:300px;height:auto;" />`;
            callback(imageUrl, html);
            setTimeout(enableImageResizing, 50); // 이미지 렌더링 후 리사이징 적용
          };
          reader.readAsDataURL(blob);
          return false;
        }
      }
    });

    function enableImageResizing() {
      const images = document.querySelectorAll('.toastui-editor-contents img.resizable-image');
      images.forEach((img) => {
        if (img.dataset.resizable) return;
        img.dataset.resizable = 'true';

        interact(img).resizable({
          edges: { left: true, right: true, bottom: true, top: true },
          preserveAspectRatio: true,
          listeners: {
            move(event) {
              const target = event.target;
              target.style.width = `${event.rect.width}px`;
              target.style.height = `${event.rect.height}px`;
            }
          }
        });
      });
    }
  </script>

  <!-- 기타 모듈 -->
  <script type="module" src="assets/vendor/ag-grid-community/dist/ag-grid-community.noStyle.js"></script>
  <script type="module" src="assets/js/logomodule.js"></script>
  <script type="module" src="assets/js/kegeditor.js"></script>
</body>

</html>
