document.addEventListener("DOMContentLoaded",(()=>{const t=new Date;async function e(t){try{const e=await fetch(t);if(!e.ok)throw new Error(`HTTP error! Status: ${e.status}`);return await e.json()}catch(e){return console.error(`Failed to fetch data from ${t}:`,e),null}}function n(t){const e=localStorage.getItem(t);return e?JSON.parse(e):null}function a(t,e){localStorage.setItem(t,JSON.stringify(e))}function o(t,e,n,a=!1){const o=document.createElement("div");o.classList.add("bg-white","p-4","rounded","shadow","relative"),e&&o.classList.add("bg-orange-300");for(let e in t)if("departmentId"===e){const a=n.find((n=>n.id===t[e])),r=document.createElement("p");r.textContent=`진료과목: ${a?a.name:"알 수 없음"}`,o.appendChild(r)}else{const n=document.createElement("p");n.textContent=`${e}: ${t[e]}`,o.appendChild(n)}if(a){const t=document.createElement("div");t.classList.add("drag-handle"),t.textContent="☰",o.appendChild(t),o.setAttribute("draggable",!0)}return o}document.querySelectorAll(".tab-hos").forEach((t=>{t.addEventListener("click",(()=>{document.querySelectorAll(".tab-hos").forEach((t=>t.classList.remove("active-tab"))),t.classList.add("active-tab"),document.querySelectorAll(".tab-content2").forEach((t=>t.classList.remove("active")));const e=document.getElementById(t.dataset.tab);e&&e.classList.add("active")}))}));const r=document.getElementById("chat-bot"),s=document.getElementById("chat-bot-messages"),d=document.getElementById("chat-bot-input"),i=document.getElementById("chat-bot-send");function c(t,e){const n=document.createElement("div");n.classList.add("p-2","mb-2","rounded"),n.classList.add(e?"bg-blue-100":"bg-gray-100"),n.textContent=t,s.appendChild(n),s.scrollTop=s.scrollHeight}r.classList.remove("hidden"),i.addEventListener("click",(async()=>{const t=d.value.trim();if(t){c(t,!0);c(`추천 진료과: ${await async function(t){const e=await fetch("https://api.github.com/copilot-api",{method:"POST",headers:{"Content-Type":"application/json",Authorization:"Bearer YOUR_GITHUB_COPILOT_TOKEN"},body:JSON.stringify({question:t})});return(await e.json()).answer}(t)}`,!1),d.value=""}})),d.addEventListener("keypress",(t=>{"Enter"===t.key&&i.click()})),async function(){let r=n("departments"),s=n("waitingList"),d=n("reservations");if(!r){if(r=await e("assets/mock/departments.json"),!r)return void console.error("Failed to load departments data.");a("departments",r)}if(!s){if(s=await e("assets/mock/wating.json"),!s)return void console.error("Failed to load waiting list data.");a("waiting",s)}if(!d){if(d=await e("/api/reservations"),!d)return void console.error("Failed to load reservations data.");a("reservations",d)}const i=document.querySelector("#departments-container");r&&r.departments?r.departments.forEach((t=>{const e=o(t,!1,r.departments);if(i.appendChild(e),t.doctors&&t.doctors.length>0){const n=document.createElement("div");n.className="doctors-list",t.doctors.forEach((t=>{const e=document.createElement("p");e.textContent=`${t.id} (${t.name})`,n.appendChild(e)})),e.appendChild(n)}})):console.error("Invalid departments data structure.",r);const c=document.querySelector("#waiting-list-container");s&&s.waitingList?s.waitingList.forEach((t=>{const e=o(t,!1,r.departments,!0);e.dataset.id=t.id,c.appendChild(e)})):console.error("Invalid waiting list data structure.",s);const l=document.querySelector("#reservations-container");d?d.forEach((e=>{const n=new Date(`${e.date}T${e.time}`),a=o(e,t.toDateString()===n.toDateString()&&t.getHours()===n.getHours()&&t.getMinutes()===n.getMinutes(),r.departments);l.appendChild(a)})):console.error("Invalid reservations data structure.",d);!function(t){const e=document.getElementById("calendar-container");e.innerHTML="";for(let n=1;n<=31;n++){const a=document.createElement("div");a.classList.add("day");const o=document.createElement("div");o.classList.add("date"),o.textContent=`1월 ${n}일`,a.appendChild(o),t.filter((t=>t.date===n)).forEach((t=>{const e=document.createElement("div");e.classList.add("schedule",t.type),e.textContent=`${t.doctor} (${"working"===t.type?"근무":"휴가"})`,a.appendChild(e)})),e.appendChild(a)}}(function(t){const e=[];return t.forEach((t=>{t.doctors.forEach((t=>{for(let n=1;n<=31;n++)Math.random()<.7?e.push({doctor:t.name,date:n,type:"working"}):e.push({doctor:t.name,date:n,type:"vacation"})}))})),e}(r.departments)),function(){let t=null;function e(t,e){return[...t.querySelectorAll("[draggable]:not(.draggable)")].reduce(((t,n)=>{const a=n.getBoundingClientRect(),o=e-a.top-a.height/2;return o<0&&o>t.offset?{offset:o,element:n}:t}),{offset:Number.NEGATIVE_INFINITY}).element}document.addEventListener("dragstart",(e=>{e.target.closest("#waiting-list-container")&&(t=e.target,setTimeout((()=>{e.target.classList.add("draggable")}),0))})),document.addEventListener("dragend",(e=>{e.target.closest("#waiting-list-container")&&(e.target.classList.remove("draggable"),t=null)})),document.addEventListener("dragover",(n=>{n.preventDefault();const a=n.target.closest("#waiting-list-container");if(a&&t){const o=e(a,n.clientY);null==o?a.appendChild(t):a.insertBefore(t,o)}}))}()}()}));