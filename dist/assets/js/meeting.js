import{createSearchButton}from"./common.js";const searchButton=createSearchButton();document.getElementById("btnContainer").appendChild(searchButton);const roomsData={rooms:[{name:"Meeting Room #1",seats:5,bookings:[]},{name:"Meeting Room #2",seats:8,bookings:[]},{name:"Meeting Room #3",seats:20,bookings:[]},{name:"Meeting Room #4",seats:20,bookings:[]},{name:"Meeting Room #5",seats:20,bookings:[]}]};function fetchBookings(){const e=localStorage.getItem("roomBookings");return e?JSON.parse(e):{rooms:[]}}function saveBookings(e){localStorage.setItem("roomBookings",JSON.stringify(e))}function displayRooms(e=null){const t=document.getElementById("rooms-container");t.innerHTML="";const n=fetchBookings(),o=(new Date).toISOString().slice(0,16);n.rooms.forEach((n=>{const d=document.createElement("div");d.className="bg-white p-4 rounded-md shadow-md text-sm",d.innerHTML=`\n                <h2 class="text-md font-bold mb-2">${n.name}</h2>\n                <p class="text-sm mb-2">Seats: ${n.seats}</p>\n                <div id="timeslots-${n.name}">\n                    ${generateTimeslots(n,e,o)}\n                </div>\n            `,t.appendChild(d)}))}localStorage.getItem("roomBookings")||localStorage.setItem("roomBookings",JSON.stringify(roomsData));export function openModal(e,t,n){if(document.getElementById("modal-title").textContent=`${t} Booking for ${e}`,document.getElementById("room-name").value=e,document.getElementById("booking-form").dataset.action=t,"Update"===t){const t=fetchBookings().rooms.find((t=>t.name===e)).bookings[n];document.getElementById("date").value=t.date,document.getElementById("startTime").value=t.startTime,document.getElementById("endTime").value=t.endTime,document.getElementById("meeting-title").value=t.title||"",document.getElementById("meeting-description").value=t.description||"",document.getElementById("booking-form").dataset.bookingIndex=n}else{document.getElementById("booking-form").reset();const e=document.getElementById("search-date").value;document.getElementById("date").value=e,document.getElementById("startTime").value=n,document.getElementById("endTime").value=`${parseInt(n.split(":")[0])+1}:00`,document.getElementById("booking-form").dataset.bookingIndex="",populateTimeOptions()}document.getElementById("booking-modal").classList.remove("hidden")}function generateTimeslots(e,t=null,n){let o="",d=8;for(;d<20;){const a=`${d.toString().padStart(2,"0")}:00`;let i=`${(d+1).toString().padStart(2,"0")}:00`,s=e.bookings.find((e=>e.date===t&&e.startTime===a));if(s){i=s.endTime,d=parseInt(s.endTime.split(":")[0]);const m=new Date(`${t}T${i}`).getTime()<new Date(n).getTime(),l=m?"회의록":"Update",c=m?"bg-green-500 hover:bg-green-600":"bg-yellow-500 hover:bg-yellow-600";o+=`\n                    <div class="flex justify-between py-1 border-b border-gray-200">\n                        <span>${a} - ${i} (${s.title})</span>\n                        <button onclick="${m?`openNotesModal(${e.bookings.indexOf(s)})`:`openModal('${e.name}', 'Update', ${e.bookings.indexOf(s)})`}" class="${c} text-white">${l}</button>\n                    </div>\n                `}else o+=`\n                    <div class="flex justify-between py-1 border-b border-gray-200">\n                        <span>${a} - ${i}</span>\n                        <button onclick="openModal('${e.name}', 'New', '${a}')" class="bg-blue-500 text-white">Add</button>\n                    </div>\n                `,d++}return o}function populateTimeOptions(){const e=document.getElementById("startTime"),t=document.getElementById("endTime");e.innerHTML="",t.innerHTML="";for(let n=8;n<20;n++){const o=document.createElement("option");o.value=`${n.toString().padStart(2,"0")}:00`,o.textContent=`${n.toString().padStart(2,"0")}:00`,e.appendChild(o);const d=document.createElement("option");d.value=`${(n+1).toString().padStart(2,"0")}:00`,d.textContent=`${(n+1).toString().padStart(2,"0")}:00`,t.appendChild(d)}}searchButton.addEventListener("click",(function(){displayRooms(document.getElementById("search-date").value)}));export function closeModal(){document.getElementById("booking-modal").classList.add("hidden")}export function closeWarningModal(){document.getElementById("warning-modal").classList.add("hidden")}export function openNotesModal(e){const t=fetchBookings().rooms.flatMap((e=>e.bookings))[e];document.getElementById("notes-modal-title").textContent=`Meeting Notes for ${t.title}`,document.getElementById("meeting-notes").value=t.notes||"",document.getElementById("meeting-notes-modal").dataset.bookingIndex=e,document.getElementById("meeting-notes-modal").classList.remove("hidden");const n=new Stackedit;n.openFile({content:{text:document.getElementById("meeting-notes").value}}),n.on("fileChange",(e=>{document.getElementById("meeting-notes").value=e.content.text,document.getElementById("meeting-notes-preview").innerHTML=e.content.html})),n.on("close",(()=>{saveMeetingNotes()}))}export function closeNotesModal(){document.getElementById("meeting-notes-modal").classList.add("hidden")}function saveMeetingNotes(){const e=document.getElementById("meeting-notes-modal").dataset.bookingIndex,t=document.getElementById("meeting-notes").value,n=fetchBookings();n.rooms.flatMap((e=>e.bookings))[e].notes=t,saveBookings(n),closeNotesModal()}window.openModal=openModal,window.closeModal=closeModal,window.openNotesModal=openNotesModal,window.closeWarningModal=closeWarningModal,document.getElementById("booking-form").addEventListener("submit",(function(e){e.preventDefault();const t=document.getElementById("room-name").value,n=document.getElementById("date").value,o=document.getElementById("startTime").value,d=document.getElementById("endTime").value,a=document.getElementById("meeting-title").value,i=document.getElementById("meeting-description").value,s=e.target.dataset.action,m=e.target.dataset.bookingIndex,l=fetchBookings(),c=l.rooms.some((e=>e.bookings.some((e=>e.title===a&&e.date===n&&(o>=e.startTime&&o<e.endTime||d>e.startTime&&d<=e.endTime||o<=e.startTime&&d>=e.endTime)))));if(c)return closeModal(),void document.getElementById("warning-modal").classList.remove("hidden");const g=l.rooms.find((e=>e.name===t));"New"===s?g.bookings.push({date:n,startTime:o,endTime:d,title:a,description:i}):"Update"===s&&(g.bookings[m]={date:n,startTime:o,endTime:d,title:a,description:i}),saveBookings(l),closeModal(),displayRooms(n)})),document.addEventListener("DOMContentLoaded",(function(){const e=(new Date).toISOString().slice(0,10);document.getElementById("search-date").value=e,displayRooms(e)}));