import{createSaveButton,createCloseButton}from"./common.js";const hotel={floors:10,roomsPerFloor:20,reservations:JSON.parse(localStorage.getItem("hotelReservations"))||{}};function renderFloor(e,t=(new Date).toISOString().split("T")[0]){const n=document.getElementById("hotel-container");n.innerHTML="";const a=document.createElement("div");a.className="floor";for(let n=1;n<=hotel.roomsPerFloor;n++){const o=`${e}-${n}`,r=document.createElement("div");r.className="room";const l=document.createElement("div");l.className="room-title",l.innerText=o;const c=document.createElement("span");c.className="badge",c.innerText="New",c.addEventListener("click",(t=>{t.stopPropagation(),manageReservation(e,n)})),l.appendChild(c),r.appendChild(l);const i=document.createElement("div");i.className="room-info";const d=hotel.reservations[o]||[],s=d.filter((e=>e.checkInDate<=t&&e.checkOutDate>=t));s.length>0?s.forEach(((n,a)=>{const r=document.createElement("div");r.innerHTML=`\n                    <p>Guest: ${n.guestName}</p>\n                    <p>Check-In: ${n.checkInDate}</p>\n                    <p>Check-Out: ${n.checkOutDate}</p>\n                    <p>Arrival Time: ${n.arrivalTime||"N/A"}</p>\n                    <p>Departure Time: ${n.departureTime||"N/A"}</p>\n                    <p>Cost: $${n.cost}</p>\n                `;const l=document.createElement("span");l.innerText="X",l.className="delete-button bg-yellow-500",console.log(a),l.addEventListener("click",(()=>{d.splice(a,1),hotel.reservations[o]=d,showToast("reserve-cancel","success",lang),renderFloor(e,t)})),r.appendChild(l),r.classList.add("reservation-item"),i.appendChild(r)})):i.innerText="No Reservation",r.appendChild(i),a.appendChild(r)}n.appendChild(a)}function manageReservation(e,t){const n=`${e}-${t}`,a=hotel.reservations[n]||[],o=document.createElement("div");o.className="modal",o.innerHTML=`\n        <div class="modal-content">\n            <h2>Manage Reservation for Room ${n}</h2>\n            <label>Guest Name:</label>\n            <input type="text" id="guestName" value="" />\n            <label>Check-In Date (YYYY-MM-DD):</label>\n            <input type="date" id="checkInDate" />\n            <label>Check-Out Date (YYYY-MM-DD):</label>\n            <input type="date" id="checkOutDate" />\n            <label>Arrival Time (HH:MM):</label>\n            <input type="time" id="arrivalTime" value="00:00" />\n            <label>Departure Time (HH:MM):</label>\n            <input type="time" id="departureTime" value="00:00" />\n            <label>Cost:</label>\n            <input type="number" id="cost" value="" />\n            <div id="btnContainer"></div>\n            \n        </div>\n    `,document.body.appendChild(o);const r=createSaveButton();r.classList.add("mr-2");const l=createCloseButton();document.getElementById("btnContainer").appendChild(r),document.getElementById("btnContainer").appendChild(l),r.addEventListener("click",(()=>{const t=document.getElementById("guestName").value,r=document.getElementById("checkInDate").value,l=document.getElementById("checkOutDate").value,c=document.getElementById("arrivalTime").value,i=document.getElementById("departureTime").value,d=parseFloat(document.getElementById("cost").value);if(!t||!r||!l||isNaN(d))return void showToast("required-input","warning","en");if(!isValidDate(r)||!isValidDate(l))return void showToast("날짜 양식을 맞춰 입력하세요");if(a.filter((e=>e.checkInDate<=l&&e.checkOutDate>=r)).length>0)return void showToast("The selected dates overlap with an existing reservation.");const s={guestName:t,checkInDate:r,checkOutDate:l,arrivalTime:c,departureTime:i,cost:d};a.push(s),hotel.reservations[n]=a;let m=localStorage.getItem("lang")||"ko";showToast("well-done","success",m),document.body.removeChild(o),renderFloor(e)})),l.addEventListener("click",(()=>{document.body.removeChild(o)}))}function isValidDate(e){return/^\d{4}-\d{2}-\d{2}$/.test(e)&&!isNaN(new Date(e).getTime())}document.addEventListener("DOMContentLoaded",(async()=>{try{const e=await fetch("assets/mock/hotel.json");if(!e.ok)throw new Error(`HTTP error! status: ${e.status}`);hotel.reservations=await e.json()}catch(e){console.error("Failed to fetch reservation data:",e),hotel.reservations={}}const e=document.createElement("div");e.id="control-panel",e.style.marginTop="10px";const t=document.createElement("div");t.id="tab-container",t.style.display="flex",t.style.gap="10px";for(let e=1;e<=hotel.floors;e++){const n=document.createElement("button");n.className="tab-button",n.innerText=`Floor ${e}`,n.addEventListener("click",(()=>{const t=document.getElementById("date-select").value;renderFloor(e,t),document.querySelectorAll(".tab-button").forEach((e=>e.classList.remove("active-tab"))),n.classList.add("active-tab")})),1===e&&n.classList.add("active-tab"),t.appendChild(n)}const n=document.createElement("input");n.type="date",n.id="date-select";const a=(new Date).toISOString().split("T")[0];n.value=a,n.addEventListener("change",(()=>{const e=document.querySelector(".tab-button.active-tab");if(e){renderFloor(parseInt(e.innerText.split(" ")[1]),n.value)}})),e.appendChild(t),e.appendChild(n),e.appendChild(n);const o=document.querySelector(".breadcrumb");o&&o.insertAdjacentElement("afterend",e),renderFloor(1)}));const container=document.createElement("div");container.id="hotel-container",document.body.appendChild(container);