import{createSaveButton,createCloseButton}from"./common.js";const hotel={floors:10,roomsPerFloor:20,reservations:{}};function renderFloor(e,t=(new Date).toISOString().split("T")[0]){const n=document.getElementById("hotel-container");n.innerHTML="";const a=document.createElement("div");a.className="floor";for(let n=1;n<=hotel.roomsPerFloor;n++){const o=`${e}-${n}`,l=document.createElement("div");l.className="room";const r=document.createElement("div");r.className="room-title",r.innerText=o;const i=document.createElement("span");i.className="badge",i.innerText="New",i.addEventListener("click",(t=>{t.stopPropagation(),manageReservation(e,n)})),r.appendChild(i),l.appendChild(r);const c=document.createElement("div");c.className="room-info";const d=hotel.reservations[o]||[],s=d.filter((e=>e.checkInDate<=t&&e.checkOutDate>=t));s.length>0?s.forEach(((n,a)=>{const l=document.createElement("div");l.innerHTML=`\n                    <p>Guest: ${n.guestName}</p>\n                    <p>Check-In: ${n.checkInDate}</p>\n                    <p>Check-Out: ${n.checkOutDate}</p>\n                    <p>Arrival Time: ${n.arrivalTime||"N/A"}</p>\n                    <p>Departure Time: ${n.departureTime||"N/A"}</p>\n                    <p>Cost: $${n.cost}</p>\n                `;const r=document.createElement("span");r.innerText="X",r.className="delete-button bg-yellow-500",r.addEventListener("click",(()=>{d.splice(a,1),hotel.reservations[o]=d,showToast("reserve-cancel","success",lang),renderFloor(e,t)})),l.appendChild(r),l.classList.add("reservation-item"),c.appendChild(l)})):c.innerText="No Reservation",l.appendChild(c),a.appendChild(l)}n.appendChild(a)}function manageReservation(e,t){const n=`${e}-${t}`,a=hotel.reservations[n]||[],o=document.createElement("div");o.className="modal",o.innerHTML=`\n        <div class="modal-content">\n            <h2>예약 추가 Room ${n}</h2>\n            <label>Guest Name:</label>\n            <input type="text" id="guestName" value="" />\n            <label>Check-In Date (YYYY-MM-DD):</label>\n            <input type="date" id="checkInDate" />\n            <label>Check-Out Date (YYYY-MM-DD):</label>\n            <input type="date" id="checkOutDate" />\n            <label>Arrival Time (HH:MM):</label>\n            <input type="time" id="arrivalTime" value="00:00" />\n            <label>Departure Time (HH:MM):</label>\n            <input type="time" id="departureTime" value="00:00" />\n            <label>Cost:</label>\n            <input type="number" id="cost" value="" />\n            <div id="btnContainer"></div>\n            \n        </div>\n    `,document.body.appendChild(o);const l=createSaveButton();l.classList.add("mr-2");const r=createCloseButton();document.getElementById("btnContainer").appendChild(l),document.getElementById("btnContainer").appendChild(r),l.addEventListener("click",(()=>{const t=document.getElementById("guestName").value,l=document.getElementById("checkInDate").value,r=document.getElementById("checkOutDate").value,i=document.getElementById("arrivalTime").value,c=document.getElementById("departureTime").value,d=parseFloat(document.getElementById("cost").value);if(!t||!l||!r||isNaN(d))return void showToast("required-input","warning",lang);if(!isValidDate(l)||!isValidDate(r))return void showToast("invalid-date-format","warning",lang);if(a.filter((e=>e.checkInDate<=r&&e.checkOutDate>=l)).length>0)return void showToast("The selected dates overlap with an existing reservation.");const s={guestName:t,checkInDate:l,checkOutDate:r,arrivalTime:i,departureTime:c,cost:d};a.push(s),hotel.reservations[n]=a,showToast("well-done","success",lang),document.body.removeChild(o),renderFloor(e)})),r.addEventListener("click",(()=>{document.body.removeChild(o)}))}function isValidDate(e){return/^\d{4}-\d{2}-\d{2}$/.test(e)&&!isNaN(new Date(e).getTime())}document.addEventListener("DOMContentLoaded",(async()=>{try{const e=await fetch("/api/bookings");if(!e.ok)throw new Error(`HTTP error! status: ${e.status}`);hotel.reservations=await e.json()}catch(e){console.error("Failed to fetch reservation data:",e),hotel.reservations={}}const e=document.createElement("div");e.id="control-panel",e.style.marginTop="10px";const t=document.createElement("div");t.id="tab-container",t.style.display="flex",t.style.gap="10px";for(let e=1;e<=hotel.floors;e++){const n=document.createElement("button");n.className="tab-button2",n.innerText=`Floor ${e}`,n.addEventListener("click",(()=>{const t=document.getElementById("date-select").value;renderFloor(e,t),document.querySelectorAll(".tab-button2").forEach((e=>e.classList.remove("active-tab"))),n.classList.add("active-tab")})),1===e&&n.classList.add("active-tab"),t.appendChild(n)}const n=document.createElement("input");n.type="date",n.id="date-select";const a=(new Date).toISOString().split("T")[0];n.value=a,n.addEventListener("change",(()=>{const e=document.querySelector(".tab-button2.active-tab");if(e){renderFloor(parseInt(e.innerText.split(" ")[1]),n.value)}})),e.appendChild(t),e.appendChild(n);document.getElementById("content").insertAdjacentElement("afterbegin",e),renderFloor(1)}));const container=document.createElement("div");container.id="hotel-container",document.body.appendChild(container);