function addQuestion(){const e=document.getElementById("questionInput"),t=e.value.trim();if(""===t)return void showToast("required-input","warning",lang);const n=Array.from(document.querySelectorAll("#optionsInput input")).map((e=>e.value.trim())).filter((e=>""!==e));if(n.length<2)return void showToast("survey-2","warning",lang);const o={id:Date.now(),text:t,options:n},a=JSON.parse(localStorage.getItem("questions"))||[];a.push(o),localStorage.setItem("questions",JSON.stringify(a)),createQuestionBox(o,document.getElementById("questionsList")),window.grid&&window.grid.appendRow(o),e.value="",document.querySelectorAll("#optionsInput input").forEach((e=>e.value=""))}function openTab(e,t){var n,o,a;for(o=document.getElementsByClassName("tabcontent"),n=0;n<o.length;n++)o[n].classList.add("hidden");for(a=document.getElementsByClassName("tablinks"),n=0;n<a.length;n++)a[n].classList.remove("bg-blue-500","text-white");document.getElementById(t).classList.remove("hidden"),e.currentTarget.classList.add("bg-blue-500","text-white"),"SurveyResponse"===t&&populateSurveySelect()}function fetchData(){waitForQuestions(),fetch("assets/mock/surveys.json").then((e=>e.json())).then((e=>{localStorage.setItem("surveys",JSON.stringify(e)),populateSurveySelect()})).catch((e=>console.error("Error fetching surveys:",e))),fetch("assets/mock/responses.json").then((e=>e.json())).then((e=>{localStorage.setItem("responses",JSON.stringify(e))})).catch((e=>console.error("Error fetching responses:",e)))}function waitForQuestions(e=0){let t=JSON.parse(localStorage.getItem("questions"));null!==t?displayQuestions(t):e<5?setTimeout((()=>waitForQuestions(e+1)),1e3):console.error("Failed to load questions after multiple attempts.")}function displayQuestions(e){const t=document.getElementById("questionsList");t.style.height="700px",t.innerHTML='<p class="mb-2">문항 목록</p>',e.forEach((e=>createQuestionBox(e,t)))}function createQuestionBox(e,t){const n=document.createElement("div");n.className="question-box border p-2 my-1 cursor-move bg-gray-100",n.draggable=!0,n.textContent=e.text,n.dataset.id=e.id,n.addEventListener("dragstart",handleDragStart),n.addEventListener("dragend",handleDragEnd),t.appendChild(n)}function handleDragStart(e){e.dataTransfer.setData("text/plain",e.target.dataset.id),e.dataTransfer.effectAllowed="move"}function handleDragEnd(e){e.dataTransfer.clearData()}function handleDragOver(e){e.preventDefault(),e.dataTransfer.dropEffect="move",e.target.classList.add("bg-gray-200")}function handleDragLeave(e){e.target.classList.remove("bg-gray-200")}function handleDrop(e){e.preventDefault(),e.target.classList.remove("bg-gray-200");const t=e.dataTransfer.getData("text/plain"),n=(JSON.parse(localStorage.getItem("questions"))||[]).find((e=>e.id==t));if(!n)return;if(e.target.querySelector(`[data-id="${t}"]`))return void showToast("이미 추가된 문항입니다.");const o=createSurveyQuestionBox(n,!0);e.target.appendChild(o)}function createSurveyQuestionBox(e,t=!1){const n=document.createElement("div");return n.className="survey-question border p-2 my-1 bg-blue-100",n.textContent=e.text,n.dataset.id=e.id,n.draggable=t,t&&(n.classList.add("cursor-move"),n.addEventListener("dragstart",handleDragStart),n.addEventListener("dragend",handleDragEnd)),n}function createSurveyQuestionBox(e,t){const n=document.createElement("div");if(n.className="question-box border p-2 my-2 relative",n.textContent=e.text,n.dataset.id=e.id,e.options.forEach((t=>{const o=document.createElement("label");o.className="block";const a=document.createElement("input");a.type="radio",a.name=`question-${e.id}`,a.value=t,o.appendChild(a),o.appendChild(document.createTextNode(t)),n.appendChild(o)})),t){const e=document.createElement("span");e.className="absolute top-1 right-1 text-red-500 text-white p-1 cursor-pointer",e.textContent="X",e.onclick=()=>n.remove(),n.appendChild(e)}return n}function saveSurvey(){const e=document.getElementById("surveyContainer"),t=Array.from(e.getElementsByClassName("question-box")).map((e=>parseInt(e.dataset.id))),n={id:Date.now(),title:"Custom Survey",description:"문항을 드래그 앤 드롭 하여 설문지를 구성 합니다.",questions:t},o=JSON.parse(localStorage.getItem("surveys"))||[];o.push(n),localStorage.setItem("surveys",JSON.stringify(o)),showToast("설문지를 추가하였습니다."),populateSurveySelect()}function populateSurveySelect(){const e=document.getElementById("surveySelect"),t=JSON.parse(localStorage.getItem("surveys"))||[];e.innerHTML='<option value="">Select a survey</option>',t.forEach((t=>{const n=document.createElement("option");n.value=t.id,n.textContent=t.title,e.appendChild(n)})),e.addEventListener("change",displaySelectedSurvey)}function displaySelectedSurvey(){const e=document.getElementById("surveySelect").value,t=(JSON.parse(localStorage.getItem("surveys"))||[]).find((t=>t.id==e)),n=document.getElementById("surveyForm");n.innerHTML="",t&&t.questions.forEach((e=>{const t=JSON.parse(localStorage.getItem("questions")).find((t=>t.id==e));if(t){const e=document.createElement("div");e.className="question-box border p-2 my-2",e.textContent=t.text,t.options.forEach((n=>{const o=document.createElement("label");o.className="block p-2";const a=document.createElement("input");a.type="radio",a.name=`question-${t.id}`,a.value=n,o.appendChild(a),o.appendChild(document.createTextNode(n)),e.appendChild(o)})),n.appendChild(e)}}))}function generateReport(e){const t=JSON.parse(localStorage.getItem("questions")),n={};t.forEach((e=>{n[`question-${e.id}`]={},e.options.forEach((t=>{n[`question-${e.id}`][t]=0}))})),e.forEach((e=>{Object.keys(e).forEach((t=>{const o=e[t];o&&n[t]&&n[t][o]++}))})),displayReport(n)}function displayReport(e){const t=document.getElementById("reportContainer");t.innerHTML="";const n=document.createElement("div");n.className="grid grid-cols-3 gap-4",t.appendChild(n);for(const t in e){const o=e[t],a=document.createElement("div");a.className="border p-4 rounded shadow-md bg-white flex flex-col items-center";const s=document.createElement("h2");s.className="text-lg font-bold mb-2 text-center";const r=JSON.parse(localStorage.getItem("questions")).find((e=>e.id==t.split("-")[1])).text;s.textContent=r,a.appendChild(s);const i=document.createElement("canvas");i.id=`chart-${t}`,i.className="w-full h-[300px]",a.appendChild(i),n.appendChild(a);const d={labels:Object.keys(o),datasets:[{data:Object.values(o),borderColor:["rgba(75, 192, 192, 0.2)","rgba(54, 162, 235, 0.2)","rgba(255, 206, 86, 0.2)","rgba(153, 102, 255, 0.2)","rgba(255, 159, 64, 0.2)"],backgroundColor:["rgba(75, 192, 192, 1)","rgba(54, 162, 235, 1)","rgba(255, 206, 86, 1)","rgba(153, 102, 255, 1)","rgba(255, 159, 64, 1)"],borderWidth:1}]},l={responsive:!0,maintainAspectRatio:!0,plugins:{legend:{position:"top"},tooltip:{callbacks:{label:function(e){return e.label+": "+e.raw}}}}};setTimeout((()=>{new Chart(i,{type:"pie",data:d,options:l})}),100)}}document.addEventListener("DOMContentLoaded",(()=>{document.getElementById("workarea").classList.add("flex","mb-4","mt-4","gap-2"),document.getElementsByClassName("tablinks")[0].click();let e=JSON.parse(localStorage.getItem("questions"));const t=document.getElementById("questionsContainer");function n(e){window.grid=new tui.Grid({el:t,data:e,columns:[{header:"ID",name:"id",width:60,sortable:!0,filter:{type:"number"}},{header:"질문",name:"text",width:250,resizable:!0,editor:"text",sortable:!0,filter:{type:"text"}},{header:"옵션",name:"options",editor:{type:"text",options:{useViewMode:!1}},minWidth:400,sortable:!0,filter:{type:"text"}}],bodyHeight:500,scrollX:!0,scrollY:!0}),grid.on("afterChange",(({changes:e})=>{let t=JSON.parse(localStorage.getItem("questions"))||[];e.forEach((e=>{const{rowKey:n,columnName:o,value:a}=e;let s=grid.getRow(n),r=t.findIndex((e=>e.id===s.id));-1!==r&&(t[r][o]="options"===o?a.split(",").map((e=>e.trim())):a)})),localStorage.setItem("questions",JSON.stringify(t))}))}t.classList.add("mt-4"),e?n(e):function e(t=0){fetch("assets/mock/questions.json").then((e=>{if(!e.ok)throw new Error(`HTTP error! Status: ${e.status}`);return e.json()})).then((e=>{localStorage.setItem("questions",JSON.stringify(e)),n(e)})).catch((n=>{console.error("Error fetching surveys:",n),t<2?setTimeout((()=>e(t+1)),2e3):console.error("Failed to fetch questions after multiple attempts.")}))}(),fetchData()})),document.getElementById("submitSurvey").addEventListener("click",(()=>{const e=document.getElementById("surveyForm"),t=new FormData(e),n={};t.forEach(((e,t)=>{n[t]=e}));const o=JSON.parse(localStorage.getItem("responses"))||[];o.push(n),localStorage.setItem("responses",JSON.stringify(o)),showToast("surveyCompleted","success","ko"),generateReport(o)}));const surveyContainer=document.getElementById("surveyContainer");function startMobileSurvey(){const e=document.getElementById("surveyForm"),t=Array.from(e.getElementsByClassName("question-box"));let n=0;const o={};function a(e){const s=document.getElementById("mobileSurveyContentInner");if(s.innerHTML="",t[e]){const r=t[e].cloneNode(!0),i=document.createElement("button");i.textContent="다음",i.className="bg-blue-500 text-white p-2 rounded mt-2 w-full",i.addEventListener("click",(()=>{const s=r.querySelector('input[type="radio"]:checked');s?(o[`question-${t[e].dataset.id}`]=s.value,n<t.length-1?(n++,a(n)):(showToast("모든 문항 답변을 완료했습니다."),document.getElementById("mobileSurveyModal").classList.add("hidden"),function(){const e=JSON.parse(localStorage.getItem("responses"))||[];e.push(o),localStorage.setItem("responses",JSON.stringify(e)),showToast("surveyCompleted","success","ko"),generateReport(e)}())):showToast("답안을 선택하세요.")})),r.appendChild(i),s.appendChild(r)}}a(n),document.getElementById("mobileSurveyModal").classList.remove("hidden")}surveyContainer.style.height="700px",surveyContainer.addEventListener("dragover",handleDragOver),surveyContainer.addEventListener("dragleave",handleDragLeave),surveyContainer.addEventListener("drop",handleDrop),document.addEventListener("DOMContentLoaded",(()=>{document.getElementsByClassName("tablinks")[0].click(),fetchData(),document.getElementById("mobileViewButton").addEventListener("click",(()=>{startMobileSurvey()}))}));