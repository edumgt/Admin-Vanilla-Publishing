const CHOSEONG_LIST=["ㄱ","ㄲ","ㄴ","ㄷ","ㄸ","ㄹ","ㅁ","ㅂ","ㅃ","ㅅ","ㅆ","ㅇ","ㅈ","ㅉ","ㅊ","ㅋ","ㅌ","ㅍ","ㅎ"];function getHangulInitial(e){if(!e||"string"!=typeof e)return"";const t=e.trim().charAt(0).charCodeAt(0)-44032;if(t<0||t>11172)return"";const o=Math.floor(t/588);return CHOSEONG_LIST[o]||""}let glossaryData=[],filteredData=[];const PAGE_SIZE=20;let currentPage=1,totalPages=1;function loadGlossaryData(){const e=localStorage.getItem("glosData");e?(console.log("로컬스토리지(glosData)에서 불러옵니다."),glossaryData=JSON.parse(e),filteredData=glossaryData,totalPages=Math.ceil(filteredData.length/20)||1,displayPage(1)):(console.log("서버(/api/glos)에서 JSON을 가져와 localStorage에 저장합니다..."),fetch("/api/glos").then((e=>e.json())).then((e=>{localStorage.setItem("glosData",JSON.stringify(e)),glossaryData=e,filteredData=e,totalPages=Math.ceil(filteredData.length/20)||1,displayPage(1)})).catch((e=>{console.error("/api/glos 가져오기 실패:",e)})))}const detailModal=document.getElementById("detailModal"),modalClose=document.querySelector(".modal-close"),modalEn=document.getElementById("modalEn"),modalKo=document.getElementById("modalKo"),modalDesc=document.getElementById("modalDesc"),modalImg=document.getElementById("modalImg"),correctionForm=document.getElementById("correctionForm"),correctionText=document.getElementById("correctionText"),saveCorrectionBtn=document.getElementById("saveCorrectionBtn"),mobileCorrectionText=document.getElementById("mobileCorrectionText"),mobileSaveCorrectionBtn=document.getElementById("mobileSaveCorrectionBtn");function openModal(e){modalEn.textContent=e.en,modalKo.textContent=e.ko,modalDesc.textContent=e.desc,document.getElementById("modalGlosId").value=e.id,console.log(document.getElementById("modalGlosId").value),correctionForm.style.display="none",correctionText.value="",e.img?(modalImg.src=e.img,modalImg.style.display="block"):modalImg.style.display="none",detailModal.classList.add("active")}function closeModal(){detailModal.classList.remove("active")}function openDetailView(e){if(window.innerWidth<=600){document.getElementById("mainContainer").style.display="none";document.getElementById("mobileDetailView").style.display="block",document.getElementById("mobileEn").textContent=e.en,document.getElementById("mobileKo").textContent=e.ko,document.getElementById("mobileDesc").textContent=e.desc,document.getElementById("modalGlosId2").value=e.id,console.log(document.getElementById("modalGlosId2").value);const t=document.getElementById("mobileImg");e.img?(t.src=e.img,t.style.display="block"):t.style.display="none",document.getElementById("mobileCorrectionForm").style.display="none",document.getElementById("mobileCorrectionText").value=""}else openModal(e)}function renderGlossaryList(e){const t=document.getElementById("glossary");t.innerHTML="",e.forEach((e=>{const o=document.createElement("div");o.className="card",o.setAttribute("role","listitem");const n=document.createElement("dt");n.textContent=e.en,n.className="en";const a=document.createElement("dt");a.textContent=e.ko,a.className="ko";let l=e.desc;l.length>20&&(l=l.slice(0,20)+"...");const d=document.createElement("dd");d.textContent=l,d.className="desc";const c=document.createElement("button");c.className="detail-btn",c.textContent="상세보기",c.addEventListener("click",(()=>{openDetailView(e)})),o.appendChild(n),o.appendChild(a),o.appendChild(d),o.appendChild(c),t.appendChild(o)}))}function displayPage(e){e<1&&(e=1),e>totalPages&&(e=totalPages),currentPage=e;const t=20*(currentPage-1),o=t+20;renderGlossaryList(filteredData.slice(t,o)),document.getElementById("searchCount").textContent=`검색 결과: ${filteredData.length}건 (페이지 ${currentPage}/${totalPages})`,renderPagination()}function renderPagination(){const e=document.getElementById("pagination");e.innerHTML="";for(let t=1;t<=totalPages;t++){const o=document.createElement("button");o.className="page-btn",o.textContent=t,o.dataset.page=t,t===currentPage&&o.classList.add("active"),e.appendChild(o)}document.querySelectorAll(".page-btn").forEach((e=>{e.addEventListener("click",(e=>{displayPage(parseInt(e.target.dataset.page,10))}))}))}function handleSearch(e){const t=e.target.value.toLowerCase().trim();filteredData=t?glossaryData.filter((e=>{const o=e.en.toLowerCase(),n=e.ko.toLowerCase(),a=e.desc.toLowerCase();return o.includes(t)||n.includes(t)||a.includes(t)})):glossaryData,totalPages=Math.ceil(filteredData.length/20)||1,displayPage(1)}function handleInitialClick(e){const t=e.target.dataset.initial;t&&(document.getElementById("searchInput").value="",filteredData=/[ㄱ-ㅎ]/.test(t)?glossaryData.filter((e=>getHangulInitial(e.ko)===t)):glossaryData.filter((e=>e.en.trim().charAt(0).toLowerCase()===t.toLowerCase())),totalPages=Math.ceil(filteredData.length/20)||1,displayPage(1))}modalClose.addEventListener("click",closeModal),detailModal.addEventListener("click",(e=>{e.target===detailModal&&closeModal()})),document.addEventListener("click",(e=>{if(e.target.classList.contains("modal-badge-btn")){const t=e.target.dataset.action;window.innerWidth<=600?"request-correction"===t?document.getElementById("mobileCorrectionForm").style.display="block":alert(`(모바일) '${t}' 버튼 클릭`):"request-correction"===t?correctionForm.style.display="block":alert(`(PC) '${t}' 버튼 클릭`)}})),saveCorrectionBtn.addEventListener("click",(()=>{const e=correctionText.value.trim();if(!e)return void alert("정정 요청 내용을 입력하세요.");const t=document.getElementById("modalGlosId").value;console.log(t),fetch("/api/glos_req",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({glos_id:t,req_msg:e})}).then((e=>e.json())).then((t=>{alert(`정정 요청이 저장되었습니다.\n\n내용: ${e}\n서버응답: ${t.message}`),correctionForm.style.display="none"})).catch((e=>{console.error("정정 요청 실패:",e),alert("정정 요청 전송 중 오류가 발생했습니다.")}))})),mobileSaveCorrectionBtn.addEventListener("click",(()=>{const e=mobileCorrectionText.value.trim();if(!e)return void alert("정정 요청 내용을 입력하세요.");const t=document.getElementById("modalGlosId2").value;console.log(t),fetch("/api/glos_req",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({glos_id:t,req_msg:e})}).then((e=>e.json())).then((t=>{alert(`정정 요청이 저장되었습니다.\n\n내용: ${e}\n서버응답: ${t.message}`),correctionForm.style.display="none"})).catch((e=>{console.error("정정 요청 실패:",e),alert("정정 요청 전송 중 오류가 발생했습니다.")}))})),document.getElementById("mobileBackBtn").addEventListener("click",(()=>{document.getElementById("mobileDetailView").style.display="none",document.getElementById("mainContainer").style.display="block"})),document.querySelectorAll(".filter-btn").forEach((e=>{e.addEventListener("click",handleInitialClick)})),document.getElementById("searchInput").addEventListener("input",handleSearch),loadGlossaryData();