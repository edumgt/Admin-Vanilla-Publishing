import{createAddButton,createDelButton,createSaveButton,createSearchButton,createResetSearchButton,createTanslations,createBadgeRenderer}from"./common.js";let rowsPerPage=20,gridBodyHeight=630;const options={year:"numeric",month:"2-digit",day:"2-digit"},currentDate=(new Date).toLocaleDateString("ko-KR",options).replace(/[\.]/g,"-").replace(/[\s]/g,"").substring(0,10);function loadPageData(e,t){const a=(e-1)*t,n=a+t;return loadData().slice(a,n)}function updateDataCount(){const e=loadData();document.getElementById("dataCount").textContent=`Total : ${e.length}`}function loadData(){const e=localStorage.getItem("gridData");return e?JSON.parse(e):[]}function saveData(e){const t=e.filter((e=>e.tpCd&&e.tpNm));localStorage.setItem("gridData",JSON.stringify(t))}fetch("assets/mock/mock.json").then((e=>{if(!e.ok)throw new Error("Network response was not ok");return e.json()})).then((e=>{loadData(e),localStorage.setItem("gridData",JSON.stringify(e))})).catch((e=>{showToast("loading-error","error",lang);const t=localStorage.getItem("gridData");t?loadData(JSON.parse(t)):console.log("No data available in local storage")}));const BadgeRenderer=createBadgeRenderer,grid=new tui.Grid({el:document.getElementById("grid"),rowHeaders:["rowNum","checkbox"],editingEvent:"click",scrollX:!0,scrollY:!0,bodyHeight:gridBodyHeight,pageOptions:{useClient:!0,perPage:rowsPerPage},rowHeight:42,minRowHeight:42,columns:[{header:"Key",name:"Key",width:250,align:"left",sortable:!0,resizable:!0,width:100,minWidth:80},{header:"Group",name:"tpCd",editor:"text",validation:{required:!0},sortable:!0,filter:"text",resizable:!0,width:150},{header:"Name",name:"tpNm",editor:"text",sortable:!0,filter:"text",resizable:!0,width:200},{header:"Desc.",name:"descCntn",editor:"text",sortable:!0,filter:"text",resizable:!0},{header:"UseYN",name:"useYn",width:100,align:"center",editor:{type:"select",options:{listItems:[{text:"Y",value:"Y"},{text:"N",value:"N"}]}},sortable:!0,filter:{type:"select",options:[{text:"All",value:""},{text:"Y",value:"Y"},{text:"N",value:"N"}]}},{header:"CreateDT",name:"createdAt",width:150,align:"center",sortable:!0},{header:"View",name:"view",align:"center",text:"V",renderer:{type:BadgeRenderer},width:60,resizable:!1}],data:loadPageData(1,rowsPerPage),columnOptions:{frozenCount:2,frozenBorderWidth:2},draggable:!0});updateDataCount();const deleteButton=createDelButton();deleteButton.addEventListener("click",(function(){grid.getCheckedRowKeys().length>0?(grid.removeCheckedRows(),saveData(grid.getData()),showToast("select-delete","success",lang),updateDataCount()):showToast("delete-not","warning",lang)}));const saveButton=createSaveButton();saveButton.addEventListener("click",(function(){const e=grid.getData().filter((e=>e.Key&&""!==e.Key.trim()));saveData(e),updateDataCount(),fetch("https://your-backend-api.com/save",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)}).then((e=>e.json())).then((e=>{showToast("well-done","success",lang)})).catch((e=>{showToast("save-error","warning",lang)}))}));const addButton=createAddButton();addButton.addEventListener("click",(function(){const e=grid.getData();if(e.some((e=>""===e.tpCd||""===e.tpNm)))return void showToast("input-allowed","info",lang);const t={Key:generateNanoId(),tpCd:"",tpNm:"",descCntn:"",useYn:"Y",createdAt:currentDate};grid.prependRow(t,{focus:!0}),saveData([...e,t]),updateDataCount()}));const searchButton=createSearchButton();btnContainer.appendChild(searchButton),btnContainer.appendChild(addButton),btnContainer.appendChild(deleteButton),btnContainer.appendChild(saveButton);const resetSearchButton=createResetSearchButton();function initNew(){const e={Key:generateNanoId(),tpCd:"",tpNm:"",descCntn:"",useYn:"Y",createdAt:currentDate};grid.prependRow(e,{focus:!0}),updateDataCount()}resetSearchButton.classList.add("ml-2"),btnContainer.appendChild(resetSearchButton),grid.on("click",(e=>{const{columnName:t,rowKey:a}=e;if("view"===t){toggleModal(!0,grid.getRow(a),a)}"Key"===e.columnName&&showToast("auto-key","info",lang)})),grid.on("editingStart",(e=>{showToast("data-possible","info",lang)})),grid.on("editingFinish",(e=>{saveData(grid.getData()),showToast("auto-save","info",lang)})),initNew(),new Pikaday({field:document.getElementById("datePicker"),format:"YYYY-MM-DD",toString(e,t){const a=e.getDate(),n=e.getMonth()+1;return`${e.getFullYear()}-${n<10?"0":""}${n}-${a<10?"0":""}${a}`}}),document.getElementById("saveModal").addEventListener("click",(()=>{const e=document.getElementById("modalForm"),t=new FormData(e),a={};for(const[e,n]of t.entries())a[e]=n;null!==currentRowKey&&(grid.setValue(currentRowKey,"tpCd",a.tpCd),grid.setValue(currentRowKey,"tpNm",a.tpNm),grid.setValue(currentRowKey,"descCntn",a.descCntn),grid.setValue(currentRowKey,"useYn",a.useYn)),toggleModal(!1),saveData(grid.getData()),showToast("well-done","success",lang)}));let currentRowKey=null;function toggleModal(e,t={},a=null){const n=document.getElementById("modal"),o=document.getElementById("modalForm");if(currentRowKey=a,e){o.innerHTML="";for(const[e,a]of Object.entries(t)){const t=document.createElement("div");t.className="flex flex-col";const n=document.createElement("label");n.className="text-sm text-gray-700",n.textContent=e;const s=document.createElement("input");s.type="text",s.className="border rounded px-3 py-2 mt-1 text-gray-900",s.name=e,s.value=a,t.appendChild(n),t.appendChild(s),o.appendChild(t)}n.classList.remove("hidden")}else n.classList.add("hidden")}searchButton.addEventListener("click",(function(){const e=loadData(),t=document.getElementById("datePicker").value,a=document.getElementById("groupCode").value.toLowerCase(),n=document.getElementById("codeName").value.toLowerCase(),o=document.getElementById("description").value.toLowerCase(),s=e.filter((e=>{const s=!t||e.createdAt===t,r=!a||e.tpCd.toLowerCase().includes(a),d=!n||e.tpNm.toLowerCase().includes(n),i=!o||e.descCntn.toLowerCase().includes(o);return s&&r&&d&&i}));grid.resetData(s),saveButton.disabled=!0,saveButton.classList.add("bg-gray-400","cursor-not-allowed"),saveButton.classList.remove("bg-gray-700","hover:bg-gray-600"),addButton.disabled=!0,addButton.classList.add("bg-gray-400","cursor-not-allowed"),addButton.classList.remove("bg-gray-700","hover:bg-gray-600"),showToast("search-click","info",lang)})),resetSearchButton.addEventListener("click",(function(){const e=loadData();document.getElementById("groupCode").value="",document.getElementById("codeName").value="",document.getElementById("description").value="",document.getElementById("datePicker").value="",grid.resetData(e),saveButton.disabled=!1,saveButton.classList.remove("bg-gray-400","cursor-not-allowed"),saveButton.classList.add("bg-gray-700","hover:bg-gray-600"),addButton.disabled=!1,addButton.classList.remove("bg-gray-400","cursor-not-allowed"),addButton.classList.add("bg-gray-700","hover:bg-gray-600"),showToast("new-save","info",lang)}));const rows=document.querySelectorAll(".tui-grid-rside-area .tui-grid-body-tbody tr");if(rows.length>0){const e=rows[rows.length-1];e.style.backgroundColor="#fff",e.style.borderBottom="1px solid #8f8f8f"}const translations=createTanslations;languageSwitcher.addEventListener("click",(function(e){let t=e.target.getAttribute("data-lang");if(localStorage.setItem("lang",t),!t||!translations[t])return;let a=translations[t].buttons;searchButton.innerHTML='<i class="fas fa-search"></i><span>'+a.search+"</span>",addButton.innerHTML='<i class="fas fa-plus"></i><span>'+a.new+"</span>",deleteButton.innerHTML='<i class="fas fa-trash"></i><span>'+a.delete+"</span>",saveButton.innerHTML='<i class="fas fa-save"></i><span>'+a.save+"</span>",resetSearchButton.innerHTML='<i class="fas fa-undo"></i><span>'+a.reset+"</span>"})),document.addEventListener("DOMContentLoaded",(()=>{let e=localStorage.getItem("lang"),t=translations[e].buttons;searchButton.innerHTML='<i class="fas fa-search"></i><span>'+t.search+"</span>",addButton.innerHTML='<i class="fas fa-plus"></i><span>'+t.new+"</span>",deleteButton.innerHTML='<i class="fas fa-trash"></i><span>'+t.delete+"</span>",saveButton.innerHTML='<i class="fas fa-save"></i><span>'+t.save+"</span>",resetSearchButton.innerHTML='<i class="fas fa-undo"></i><span>'+t.reset+"</span>"}));