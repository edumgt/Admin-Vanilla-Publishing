const workarea=document.getElementById("workarea");workarea.classList.add("header","mt-4"),createModal3("modalTime","일정변경",'<div class="popup" id="popup">\n        <input type="text" id="event-title" placeholder="Event Title">\n        <input type="datetime-local" id="event-start">\n        <input type="datetime-local" id="event-end">\n        <div class="error" id="date-error">시작일이 종료일 보다 이후 날짜 입니다.</div>\n        <button class="bg-blue-500 text-white" id="save-event">저장</button>\n        <button class="bg-gray-500 text-white" id="close-popup">닫기</button>\n    </div>',[]);const closepopup=document.getElementById("close-popup"),today=new Date;let events=[],startDate=new Date(today);startDate.setDate(today.getDate()-5);let currentEventId=null;async function fetchData(e){try{const t=await fetch(e);if(!t.ok)throw new Error("Network response was not ok");const n=await t.json();localStorage.setItem("events",JSON.stringify(n)),events=n.map((e=>({...e,color:getRandomColor()}))),renderTimeline()}catch(e){console.error("Fetch error:",e)}}function loadEvents(e){const t=localStorage.getItem("events");t?(events=JSON.parse(t),renderTimeline()):fetchData(e)}function getRandomColor(){let e="#";for(let t=0;t<6;t++)e+="0123456789ABCDEF"[Math.floor(16*Math.random())];return e}function renderTimeline(){const e=document.getElementById("timeline-header"),t=document.getElementById("timeline-content"),n=new Date(startDate);n.setDate(startDate.getDate()+10);const a=Math.floor((n-startDate)/864e5)+1;for(;e.firstChild;)e.removeChild(e.firstChild);for(;t.firstChild;)t.removeChild(t.firstChild);for(let t=0;t<a;t++){const n=document.createElement("div");n.className="day";const a=new Date(startDate);a.setDate(startDate.getDate()+t),n.textContent=a.getDate(),a.toDateString()===today.toDateString()&&n.classList.add("today"),e.appendChild(n)}events.forEach((e=>{renderEvent(e)})),interact(".event").draggable({inertia:!0,modifiers:[interact.modifiers.restrictRect({restriction:".timeline",endOnly:!0})],autoScroll:!0,listeners:{move(e){const t=e.target,n=(parseFloat(t.getAttribute("data-x"))||0)+e.dx,a=(parseFloat(t.getAttribute("data-y"))||0)+e.dy;t.style.transform=`translate(${n}px, ${a}px)`,t.setAttribute("data-x",n),t.setAttribute("data-y",a)},end(e){const t=e.target,n=parseFloat(t.getAttribute("data-x"))||0,o=parseFloat(t.getAttribute("data-y"))||0,r=t.parentElement.offsetWidth/a,d=Math.round(n/r);let s=Math.floor((t.offsetTop+o+t.clientHeight/2)/70);s<0&&(s=0),s>7&&(s=7);const l=t.getAttribute("data-id"),i=events.findIndex((e=>e.id==l)),c=new Date(events[i].start),m=new Date(events[i].end),u=Math.floor((m-c)/864e5),v=new Date(startDate);v.setDate(startDate.getDate()+Math.floor((c-startDate)/864e5)+d);const g=new Date(v);g.setDate(v.getDate()+u),events[i].start=v.toISOString(),events[i].end=g.toISOString(),events[i].row=s,t.style.transform="translate(0, 0)",t.setAttribute("data-x",0),t.setAttribute("data-y",0),localStorage.setItem("events",JSON.stringify(events)),renderTimeline()}}})}function renderEvent(e,t=null){const n=document.getElementById("timeline-content"),a=new Date(startDate);a.setDate(startDate.getDate()+10);const o=Math.floor((a-startDate)/864e5)+1,r=new Date(e.start),d=new Date(e.end),s=Math.floor((r-startDate)/864e5),l=Math.floor((d-startDate)/864e5)-s+1;let i=t;i||(i=document.createElement("div"),i.className="event",i.setAttribute("data-id",e.id),n.appendChild(i),i.addEventListener("dblclick",(()=>{currentEventId=e.id,document.getElementById("event-title").value=e.title,document.getElementById("event-start").value=new Date(e.start).toISOString().substring(0,16),document.getElementById("event-end").value=new Date(e.end).toISOString().substring(0,16),document.getElementById("date-error").style.display="none",document.getElementById("modalTime").style.display="block",document.getElementById("popup").classList.add("active")})));const c=document.createElement("span");c.className="event-date",c.textContent=`${r.toISOString().split("T")[0]} ~ ${d.toISOString().split("T")[0]}`,i.innerHTML="",i.appendChild(c),i.appendChild(document.createTextNode(e.title)),i.style.left=s/o*100+"%",i.style.width=l/o*100+"%",i.style.top=70*e.row+"px",i.style.backgroundColor=e.color}document.getElementById("prev-btn").addEventListener("click",(()=>{startDate.setDate(startDate.getDate()-5),renderTimeline()})),document.getElementById("next-btn").addEventListener("click",(()=>{startDate.setDate(startDate.getDate()+5),renderTimeline()})),document.getElementById("save-event").addEventListener("click",(()=>{const e=document.getElementById("event-title").value,t=document.getElementById("event-start").value,n=document.getElementById("event-end").value;if(new Date(t)>new Date(n))document.getElementById("date-error").style.display="block";else{if(document.getElementById("date-error").style.display="none",null!==currentEventId){const a=events.findIndex((e=>e.id==currentEventId));events[a].title=e,events[a].start=new Date(t).toISOString(),events[a].end=new Date(n).toISOString(),localStorage.setItem("events",JSON.stringify(events)),renderTimeline(),currentEventId=null}document.getElementById("modalTime").style.display="none",document.getElementById("popup").classList.remove("active")}})),document.getElementById("close-popup").addEventListener("click",(()=>{document.getElementById("modalTime").style.display="none",document.getElementById("popup").classList.remove("active")})),document.addEventListener("DOMContentLoaded",(()=>{loadEvents("assets/mock/timeline.json")}));