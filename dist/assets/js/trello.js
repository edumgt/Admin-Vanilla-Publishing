import{createSaveButton}from"./common.js";const workarea=document.getElementById("trelloapp");workarea.classList.add("mt-4");const taskList=document.getElementById("taskList"),ganttTableBody=document.getElementById("ganttTableBody"),splitter=document.getElementById("splitter"),taskArea=document.getElementById("taskArea"),ganttArea=document.getElementById("ganttArea"),saveButton=createSaveButton();saveButton.addEventListener("click",(()=>{console.log("##");const t=document.getElementById("taskName").value,e=document.getElementById("taskDescription").value,a=document.getElementById("taskStartDate").value,n=document.getElementById("taskEndDate").value;t&&a&&n?(tasks.push({name:t,description:e,startDate:a,endDate:n}),saveTasks(tasks)):showToast("required-input","warning",lang)}));const btnArea=document.getElementById("btn-area");btnArea.appendChild(saveButton);let tasks=[];async function fetchTasks(){try{const t=await fetch("assets/mock/task.json");if(!t.ok)throw new Error(`HTTP error! Status: ${t.status}`);const e=await t.json();tasks=[...loadTasks(),...e],renderTaskList(),renderGanttChart()}catch(t){console.error("Error fetching tasks:",t)}}function loadTasks(){return JSON.parse(localStorage.getItem("tasks"))||[]}function saveTasks(t){localStorage.setItem("tasks",JSON.stringify(t))}function renderTaskList(){taskList.innerHTML="",tasks.forEach(((t,e)=>{const a=document.createElement("li");a.style.position="relative",a.draggable=!0,a.dataset.index=e,a.innerHTML=`\n                <strong>${t.name}</strong><br>\n                <small>${t.description||"No description"}</small><br>\n                <small>Start Date: ${t.startDate}</small><br>\n                <small>End Date: ${t.endDate}</small>\n                <div class="drag-indicator"><i class="fas fa-arrows-alt"></i> Drag & Drop</div>\n            `;const n=document.createElement("button");n.textContent="X",n.style.position="absolute",n.style.top="10px",n.style.right="10px",n.style.backgroundColor="transparent",n.style.border="none",n.style.color="red",n.style.fontWeight="bold",n.style.cursor="pointer",n.style.fontSize="16px",n.addEventListener("click",(()=>{removeTask(e)})),a.appendChild(n),taskList.appendChild(a)})),addDragAndDrop()}function renderGanttChart(){if(ganttTableBody.innerHTML="",0===tasks.length)return;const t=new Date(Math.min(...tasks.map((t=>new Date(t.startDate).getTime())))),e=new Date(Math.max(...tasks.map((t=>new Date(t.endDate).getTime())))),a=Math.ceil((e-t)/864e5)+1;tasks.forEach((e=>{const n=new Date(e.startDate),s=new Date(e.endDate),r=document.createElement("tr");r.innerHTML=`\n            <td>${e.name}</td>\n            <td>${n.toLocaleDateString()}</td>\n            <td>${s.toLocaleDateString()}</td>\n            <td class="timeline-column"><div class="timeline2"></div></td>\n        `;const o=r.querySelector(".timeline2");for(let e=0;e<a;e++){const a=new Date(t);a.setDate(t.getDate()+e);const r=document.createElement("div");r.style.width="24px",r.style.height="24px",r.style.border="1px solid #ddd",r.style.display="inline-block",r.style.backgroundColor=a>=n&&a<=s?"#0058a3":"#e8eaee",o.appendChild(r)}ganttTableBody.appendChild(r)}))}function removeTask(t){tasks.splice(t,1),saveTasks(tasks),renderTaskList(),renderGanttChart()}function addDragAndDrop(){taskList.querySelectorAll("li").forEach((t=>{t.addEventListener("dragstart",handleDragStart),t.addEventListener("dragover",handleDragOver),t.addEventListener("drop",handleDrop),t.addEventListener("dragend",handleDragEnd)}))}let dragSourceIndex=null;function handleDragStart(t){dragSourceIndex=+this.dataset.index,this.style.opacity="0.5",t.dataTransfer.effectAllowed="move"}function handleDragOver(t){t.preventDefault(),t.dataTransfer.dropEffect="move"}function handleDrop(t){t.preventDefault();const e=+this.dataset.index;if(null!==dragSourceIndex&&e!==dragSourceIndex){const[t]=tasks.splice(dragSourceIndex,1);tasks.splice(e,0,t),saveTasks(tasks),renderTaskList(),renderGanttChart()}}function handleDragEnd(){this.style.opacity="1"}function createSplitter(t,e,a){let n=!1;t.addEventListener("mousedown",(()=>{n=!0,document.body.style.cursor="col-resize"})),document.addEventListener("mousemove",(s=>{if(!n)return;const r=t.parentElement.getBoundingClientRect(),o=t.offsetWidth+20,d=s.clientX-r.left-10,l=r.right-s.clientX-o+10;d>200&&l>200&&(e.style.flex=`0 0 ${d}px`,t.style.flex="0 0 5px",a.style.flex=`0 0 ${l}px`)})),document.addEventListener("mouseup",(()=>{n&&(n=!1,document.body.style.cursor="default")}))}createSplitter(splitter,taskArea,ganttArea),fetchTasks();