const workarea=document.getElementById("workarea");workarea.classList.add("flex","items-center","mb-2","mt-4");let attendanceData=[],sortDirection="asc";export let manager;window.manager=manager;export class AttendanceManager{constructor(e){this.data=e}getMonthlyAttendance(e,t,n){const a=`${n}`;if("ALL"===e)return this.data.map((e=>({...e,attendance:e.attendance.filter((e=>e.date.startsWith(`${t}-${a}`)))})));{const n=this.data.find((t=>t.employeeId===e));return n?[{...n,attendance:n.attendance.filter((e=>e.date.startsWith(`${t}-${a}`)))}]:[]}}getMonthlyAttendanceAllDepartments(e,t){const n=`${t}`;return this.data.map((t=>({...t,attendance:t.attendance.filter((t=>t.date.startsWith(`${e}-${n}`)))})))}getMonthlyAttendanceByDepartment(e,t,n){const a=`${n}`;return this.data.filter((t=>t.department===e)).map((e=>({...e,attendance:e.attendance.filter((e=>e.date.startsWith(`${t}-${a}`)))})))}}function populateDepartmentSelect(){const e=document.getElementById("departmentSelect"),t=[...new Set(attendanceData.map((e=>e.department)))];t.forEach((t=>{const n=document.createElement("option");n.value=t,n.text=t,e.appendChild(n)})),t.length>0&&(e.value=t[0])}window.AttendanceManager=AttendanceManager,fetch("assets/mock/attend.json").then((e=>e.json())).then((e=>{attendanceData=e,manager=new AttendanceManager(attendanceData),populateDepartmentSelect(),updateEmployeeSelect()})).catch((e=>console.error("Error fetching attendance data:",e)));export function updateEmployeeSelect(){const e=document.getElementById("departmentSelect").value,t=document.getElementById("employeeSelect");t.innerHTML="";const n=document.createElement("option");n.value="ALL",n.text="ALL",t.appendChild(n);const a=attendanceData.filter((t=>t.department===e));a.forEach((e=>{const n=document.createElement("option");n.value=e.employeeId,n.text=`${e.name} (${e.employeeId})`,t.appendChild(n)})),a.length>0&&(t.value="ALL"),showAttendance()}function getLastDayOfMonth(e,t){return new Date(e,t,0).getDate()}window.updateEmployeeSelect=updateEmployeeSelect;export function showAttendance(){const e=document.getElementById("employeeSelect").value,t=document.getElementById("monthSelect").value,[n,a]=t.split("-"),o=getLastDayOfMonth(n,a),c=(new Date).toISOString().split("T")[0];let d;const r=document.getElementById("departmentSelect").value;if(!manager)return void console.error("Manager is not initialized.");d="ALL"===e?manager.getMonthlyAttendanceByDepartment(r,n,a):manager.getMonthlyAttendance(e,n,a);const l=document.getElementById("dateRow"),s=document.getElementById("attendanceBody");l.innerHTML='\n  <th class="px-3 py-2 text-left text-xs uppercase tracking-wider sortable" onclick="sortTableByName()">\n  직원 명<span id="sortIcon">▲</span></th>\n  ',s.innerHTML="";let i=-1;for(let e=1;e<=o;e++){const t=`${n}-${a}-${e.toString().padStart(2,"0")}`,o=new Date(n,a-1,e),d=0===o.getDay()||6===o.getDay(),r=6===o.getDay(),s=document.createElement("th");s.className="px-3 py-2 text-xs uppercase tracking-wider bg-gray-500 "+(t===c?"bg-blue-500":r?"text-black":d?"text-red-300":""),s.textContent=t,t===c&&(i=e),l.appendChild(s)}d.forEach((e=>{const t=document.createElement("td");t.className="px-3 py-2 whitespace-nowrap ikea-yellow-border bg-white";const d=e.attendance.length,r=(d/o*100).toFixed(2);t.innerHTML=`\n    <a href='#' class='a-link open-modal' data-name='${e.name}' data-id='${e.id}'>\n    ${e.name} (${d}/${o}, ${r}%)</a>\n    `;const l=document.createElement("tr");l.className="hover:bg-gray-100",l.appendChild(t);for(let t=1;t<=o;t++){const o=`${n}-${a}-${t.toString().padStart(2,"0")}`,d=e.attendance.find((e=>e.date===o)),r=document.createElement("td");r.className="px-3 py-2 whitespace-nowrap text-xs ikea-yellow-border bg-white editable "+(o===c?"text-orange-600 font-bold":""),d?r.innerHTML=`\n              <div>Check-In: <span class="${d.checkIn>"09:00"?"text-red-500":""}">${d.checkIn}</span></div>\n              <div>Check-Out: <span class="${d.checkOut>"18:00"?"text-orange-500":""}">${d.checkOut}</span></div>\n            `:(r.innerHTML="--",r.ondblclick=()=>makeEditable(r,e.employeeId,o)),l.appendChild(r)}s.appendChild(l)})),-1!==i&&setTimeout((()=>{const e=l.children[i];e&&e.scrollIntoView({behavior:"smooth",block:"center",inline:"center"})}),500)}function openModal(e,t){const n=document.createElement("div");n.className="modal",n.innerHTML=`\n      <div style='position: relative; display: flex; align-items: flex-start;'>\n      <iframe src='account-pop.html?name=${encodeURIComponent(e)}&id=${encodeURIComponent(t)}' width='1440' height='700' class='rounded'></iframe>\n      <span class='close' style='margin-left: 10px; font-size: 30px; font-weight: 900; cursor: pointer;'>&times;</span>        \n          \n      </div>`,document.body.appendChild(n),n.querySelector(".close").addEventListener("click",(function(){document.body.removeChild(n)}))}function makeEditable(e,t,n){e.innerHTML=`\n        <div>\n          Check-In:&nbsp;&nbsp;&nbsp;<input type="time" id="checkInInput" class="border rounded px-3 py-1"><br>\n          Check-Out:<input type="time" id="checkOutInput" class="border rounded px-3 py-1">\n          <button class="text-white px-3 py-1 rounded bg-gray-700 hover:bg-gray-600" onclick="saveAttendance('${t}', '${n}')">저장</button>\n        </div>\n      `}window.showAttendance=showAttendance,document.addEventListener("click",(function(e){if(e.target.classList.contains("open-modal")){e.preventDefault();openModal(e.target.getAttribute("data-name"),e.target.getAttribute("data-id"))}}));export function saveAttendance(e,t){const n=document.getElementById("checkInInput").value,a=document.getElementById("checkOutInput").value;if(n&&a){let o=attendanceData.find((t=>t.employeeId===e));if(!o)return void console.error(`Employee with ID ${e} not found.`);const c=o.attendance.findIndex((e=>e.date===t));-1===c?o.attendance.push({date:t,checkIn:n,checkOut:a}):o.attendance[c]={date:t,checkIn:n,checkOut:a},localStorage.setItem("attendanceData",JSON.stringify(attendanceData)),showAttendance()}else showToast("required-input","warning",lang)}function sortTableByName(){const e=document.getElementById("attendanceTable").tBodies[0],t=Array.from(e.rows);sortDirection="asc"===sortDirection?"desc":"asc",t.sort(((e,t)=>{const n=e.cells[0].textContent.trim().toLowerCase(),a=t.cells[0].textContent.trim().toLowerCase();return"asc"===sortDirection?n.localeCompare(a):a.localeCompare(n)}));document.getElementById("sortIcon").textContent="asc"===sortDirection?"▲":"▼",t.forEach((t=>e.appendChild(t)))}window.saveAttendance=saveAttendance,window.onload=()=>{const e=localStorage.getItem("attendanceData");e&&(attendanceData=JSON.parse(e)),attendanceData.length>0&&updateEmployeeSelect()};