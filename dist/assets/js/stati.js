import{createAddButton,createDelButton,createSaveButton,createSearchButton,createResetSearchButton,createTanslations,createBadgeRenderer}from"./common.js";const translations=createTanslations,workarea=document.getElementById("workarea");workarea.classList.add("grid","grid-cols-1","lg:grid-cols-4","gap-4","py-1","mt-4");let rowsPerPage=15,gridBodyHeight=430;const options={year:"numeric",month:"2-digit",day:"2-digit"};function loadPageData(e,t){const a=(e-1)*t,o=a+t;return loadData().slice(a,o)}function updateDataCount(){const e=loadData();document.getElementById("dataCount").textContent=`Total : ${e.length}`}function loadData(){const e=localStorage.getItem("membersData");return e?JSON.parse(e):[]}function saveData(e){const t=e.filter((e=>e.team&&e.name));localStorage.setItem("membersData",JSON.stringify(t))}fetch("/api/members").then((e=>{if(!e.ok)throw new Error("Network response was not ok");return e.json()})).then((e=>{loadData(e),localStorage.setItem("membersData",JSON.stringify(e))})).catch((e=>{showToast("loading-error","error",lang);const t=localStorage.getItem("membersData");t&&loadData(JSON.parse(t))}));const BadgeRenderer=createBadgeRenderer,grid=new tui.Grid({el:document.getElementById("grid"),rowHeaders:["rowNum","checkbox"],editingEvent:"click",scrollX:!0,scrollY:!0,bodyHeight:gridBodyHeight,pageOptions:{useClient:!0,perPage:rowsPerPage},rowHeight:42,minRowHeight:42,columns:[{header:"Key",name:"id",align:"left",sortable:!0,resizable:!0,width:250,minWidth:80},{header:"Team",name:"team",editor:"text",validation:{required:!0},sortable:!0,filter:"text",resizable:!0,width:150},{header:"Name",name:"name",editor:"text",sortable:!0,filter:"text",resizable:!0,width:200},{header:"Email",name:"email",editor:"text",sortable:!0,filter:"text",resizable:!0},{header:"Address",name:"address",editor:"text",sortable:!0,filter:"text",resizable:!0},{header:"입사년도",name:"joinYear",width:150,align:"center",sortable:!0},{header:"View",name:"view",align:"center",text:"V",renderer:{type:BadgeRenderer},width:60,resizable:!1}],data:loadPageData(1,rowsPerPage),columnOptions:{frozenCount:2,frozenBorderWidth:2},draggable:!0});updateDataCount();const deleteButton=createDelButton();deleteButton.addEventListener("click",(function(){grid.getCheckedRowKeys().length>0?(grid.removeCheckedRows(),saveData(grid.getData()),showToast("select-delete","success",lang),updateDataCount()):showToast("delete-not","warning",lang)}));const saveButton=createSaveButton();saveButton.addEventListener("click",(function(){const e=grid.getData().filter((e=>e.Key&&""!==e.Key.trim()));saveData(e),updateDataCount(),fetch("https://your-backend-api.com/save",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)}).then((e=>e.json())).then((e=>{showToast("well-done","success",lang)})).catch((e=>{showToast("save-error","warning",lang)}))}));const addButton=createAddButton();addButton.addEventListener("click",(function(){const e=grid.getData();if(e.some((e=>""===e.team||""===e.name)))return void showToast("input-allowed","info",lang);const t={id:generateNanoId(),team:"",name:"",email:"",address:"",joinYear:""};grid.prependRow(t,{focus:!0}),saveData([...e,t]),updateDataCount()}));const searchButton=createSearchButton();btnContainer.appendChild(searchButton),btnContainer.appendChild(addButton),btnContainer.appendChild(deleteButton),btnContainer.appendChild(saveButton);const resetSearchButton=createResetSearchButton();function initNew(){const e={id:generateNanoId(),team:"",name:"",email:"",address:"",joinYear:""};grid.prependRow(e,{focus:!0}),updateDataCount()}resetSearchButton.classList.add("ml-2"),btnContainer.appendChild(resetSearchButton),grid.on("click",(e=>{const{columnName:t,rowKey:a}=e;if("view"===t){toggleModal(!0,grid.getRow(a),a)}"id"===e.columnName&&showToast("auto-key","info",lang)})),grid.on("editingStart",(e=>{showToast("data-possible","info",lang)})),grid.on("editingFinish",(e=>{saveData(grid.getData()),showToast("well-done","info",lang)})),initNew(),new Pikaday({field:document.getElementById("datePicker"),format:"YYYY-MM-DD",toString(e,t){const a=e.getDate(),o=e.getMonth()+1;return`${e.getFullYear()}-${o<10?"0":""}${o}-${a<10?"0":""}${a}`}}),document.getElementById("saveModal").addEventListener("click",(()=>{const e=document.getElementById("modalForm"),t=new FormData(e),a={};for(const[e,o]of t.entries())a[e]=o;null!==currentRowKey&&(grid.setValue(currentRowKey,"team",a.team),grid.setValue(currentRowKey,"name",a.name),grid.setValue(currentRowKey,"email",a.email),grid.setValue(currentRowKey,"address",a.address),grid.setValue(currentRowKey,"joinYear",a.joinYear)),toggleModal(!1),saveData(grid.getData()),showToast("well-done","success",lang)}));let currentRowKey=null;function toggleModal(e,t={},a=null){const o=document.getElementById("modal"),n=document.getElementById("modalForm");if(currentRowKey=a,e){n.innerHTML="";for(const[e,a]of Object.entries(t)){const t=document.createElement("div");t.className="flex flex-col";const o=document.createElement("label");o.className="text-sm  text-gray-700",o.textContent=e;const r=document.createElement("input");r.type="text",r.className="border rounded px-3 py-2 mt-1 text-gray-900",r.name=e,r.value=a,t.appendChild(o),t.appendChild(r),n.appendChild(t)}o.classList.remove("hidden")}else o.classList.add("hidden")}searchButton.addEventListener("click",(function(){const e=loadData(),t=(document.getElementById("datePicker").value,document.getElementById("team").value.toLowerCase()),a=document.getElementById("name").value.toLowerCase(),o=document.getElementById("email").value.toLowerCase(),n=e.filter((e=>{const n=!t||e.team.toLowerCase().includes(t),r=!a||e.name.toLowerCase().includes(a),d=!o||e.email.toLowerCase().includes(o);return n&&r&&d}));grid.resetData(n),saveButton.disabled=!0,saveButton.classList.add("bg-gray-400","cursor-not-allowed"),saveButton.classList.remove("bg-gray-700","hover:bg-gray-600"),addButton.disabled=!0,addButton.classList.add("bg-gray-400","cursor-not-allowed"),addButton.classList.remove("bg-gray-700","hover:bg-gray-600"),showToast("search-click","info",lang)})),resetSearchButton.addEventListener("click",(function(){const e=loadData();document.getElementById("team").value="",document.getElementById("name").value="",document.getElementById("email").value="",document.getElementById("datePicker").value="",grid.resetData(e),saveButton.disabled=!1,saveButton.classList.remove("bg-gray-400","cursor-not-allowed"),saveButton.classList.add("bg-gray-700","hover:bg-gray-600"),addButton.disabled=!1,addButton.classList.remove("bg-gray-400","cursor-not-allowed"),addButton.classList.add("bg-gray-700","hover:bg-gray-600"),showToast("new-save","info",lang)}));const rows=document.querySelectorAll(".tui-grid-rside-area .tui-grid-body-tbody tr");if(rows.length>0){const e=rows[rows.length-1];e.style.backgroundColor="#fff",e.style.borderBottom="1px solid #8f8f8f"}