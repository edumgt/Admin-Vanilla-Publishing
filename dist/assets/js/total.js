const workarea=document.getElementById("workarea");function setupGrid(e){const t=[],r=Array(12).fill(0);e.forEach((e=>{let a=Array(12).fill(0);e.members.forEach((m=>{const n={team:e.name,name:m.name,id:m.id};m.sales.forEach(((e,t)=>{n[`month${t+1}`]=e,a[t]+=e,r[t]+=e})),t.push(n)}));const m={team:`${e.name} 합계`,name:"합계",id:"",...Object.fromEntries(a.map(((e,t)=>[`month${t+1}`,e])))};t.push(m)})),Object.assign({team:"총 합계",name:""},Object.fromEntries(r.map(((e,t)=>[`month${t+1}`,e]))));const a=new tui.Grid({el:document.getElementById("workarea"),data:t,scrollX:!0,scrollY:!0,columnOptions:{resizable:!0},summary:{height:50,position:"bottom",columnContent:{team:{template:()=>"<strong>총 합계</strong>"},month1:{sum:!0,template:summaryFormatter},month2:{sum:!0,template:summaryFormatter},month3:{sum:!0,template:summaryFormatter},month4:{sum:!0,template:summaryFormatter},month5:{sum:!0,template:summaryFormatter},month6:{sum:!0,template:summaryFormatter},month7:{sum:!0,template:summaryFormatter},month8:{sum:!0,template:summaryFormatter},month9:{sum:!0,template:summaryFormatter},month10:{sum:!0,template:summaryFormatter},month11:{sum:!0,template:summaryFormatter},month12:{sum:!0,template:summaryFormatter}}},columns:[{header:"팀",name:"team",align:"center",rowSpan:!0},{header:"팀원",name:"name",align:"center"},{header:"Key",name:"id",align:"center",formatter:e=>"합계"!==e.value?`\n                \n                <a href='#' class='a-link open-modal' data-name='${e.row.name}' data-id='${e.value}'>${e.value}</a>\n                \n                `:e.value},{header:"1월",name:"month1",formatter:formatCurrency},{header:"2월",name:"month2",formatter:formatCurrency},{header:"3월",name:"month3",formatter:formatCurrency},{header:"4월",name:"month4",formatter:formatCurrency},{header:"5월",name:"month5",formatter:formatCurrency},{header:"6월",name:"month6",formatter:formatCurrency},{header:"7월",name:"month7",formatter:formatCurrency},{header:"8월",name:"month8",formatter:formatCurrency},{header:"9월",name:"month9",formatter:formatCurrency},{header:"10월",name:"month10",formatter:formatCurrency},{header:"11월",name:"month11",formatter:formatCurrency},{header:"12월",name:"month12",formatter:formatCurrency}],rowHeaders:["rowNum"]});a.on("onGridMounted",(()=>{a.getData().forEach(((e,t)=>{"합계"===e.name&&a.addRowClassName(t,"summary-row")}))})),a.on("afterRender",(()=>{document.querySelectorAll(".custom-link").forEach((e=>{e.style.color="blue",e.style.textDecoration="underline"}))})),fixSummaryRow(a)}function openModal(e,t){const r=document.createElement("div");r.className="modal",r.innerHTML=`\n        <div style='position: relative; display: flex; align-items: flex-start;'>\n        <iframe src='account-pop.html?name=${encodeURIComponent(e)}&id=${encodeURIComponent(t)}' width='1440' height='700' class='rounded'></iframe>\n        <span class='close' style='margin-left: 10px; font-size: 30px; font-weight: 900; cursor: pointer;'>&times;</span></div>`,document.body.appendChild(r),r.querySelector(".close").addEventListener("click",(function(){document.body.removeChild(r)}))}function fixSummaryRow(e){const t=document.getElementById("workarea").querySelector(".tui-grid-container");t.classList.add("w-full","mt-4","h-full");const r=document.querySelector(".tui-grid-summary-area");t&&r&&t.addEventListener("scroll",(()=>{r.style.left=`-${t.scrollLeft}px`}))}function formatCurrency({value:e}){return e?e.toLocaleString()+" 원":"-"}function summaryFormatter(e){return`<strong>${Number(e?.sum||0).toLocaleString()} 원</strong>`}workarea.classList.add("mt-4"),document.addEventListener("DOMContentLoaded",(()=>{fetch("assets/mock/total.json").then((e=>e.json())).then((e=>{setupGrid(e)})).catch((e=>showToast("loading-error","error",lang)))})),document.addEventListener("click",(function(e){if(e.target.classList.contains("open-modal")){e.preventDefault();openModal(e.target.getAttribute("data-name"),e.target.getAttribute("data-id"))}}));