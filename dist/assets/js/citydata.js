import{createSearchButton}from"./common.js";const searchButton=createSearchButton();let grid,rawData;function fetchDataAndInitialize(){fetch("assets/mock/citydata.json").then((e=>e.json())).then((e=>{rawData=e,localStorage.setItem("adminData",JSON.stringify(e)),populateSidoSelect(e),initializeGrid(flattenData(e))})).catch((e=>console.error("Error loading data:",e)))}function initializeGrid(e){grid&&grid.destroy(),grid=new tui.Grid({el:document.getElementById("gridContainer"),columns:[{header:"읍면동",name:"읍면동"},{header:"우편번호",name:"우편번호"},{header:"위도",name:"위도"},{header:"경도",name:"경도"},{header:"약국수",name:"약국수",editor:"text",editable:!0},{header:"병의원수",name:"병의원수",editor:"text",editable:!0},{header:"학교수",name:"학교수",editor:"text",editable:!0},{header:"주차장수",name:"주차장수",editor:"text",editable:!0},{header:"주민수",name:"주민수",editor:"text",editable:!0},{header:"상점수",name:"상점수",editor:"text",editable:!0},{header:"공원수",name:"공원수",editor:"text",editable:!0},{header:"도서관수",name:"도서관수",editor:"text",editable:!0},{header:"버스정류장수",name:"버스정류장수",editor:"text",editable:!0},{header:"지하철역수",name:"지하철역수",editor:"text",editable:!0},{header:"음식점수",name:"음식점수",editor:"text",editable:!0},{header:"체육시설수",name:"체육시설수",editor:"text",editable:!0},{header:"문화시설수",name:"문화시설수",editor:"text",editable:!0},{header:"관광명소수",name:"관광명소수",editor:"text",editable:!0},{header:"주택수",name:"주택수",editor:"text",editable:!0},{header:"입력일자",name:"입력일자"},{header:"수정일자",name:"수정일자"}],data:e,rowHeaders:["checkbox","rowNum"],scrollX:!0,scrollY:!0,bodyHeight:220,frozenCount:1,frozenBorderWidth:2,minWidth:1600}),grid.on("editingFinish",updateLocalStorage),grid.on("check",handleSelectionChange),grid.on("uncheck",handleSelectionChange)}function flattenData(e){return Object.values(e).flatMap((e=>Object.values(e).flat()))}function populateSidoSelect(e){const a=document.getElementById("sidoSelect");a.innerHTML='<option value="">전체</option>',Object.keys(e).forEach((e=>{const t=document.createElement("option");t.value=e,t.textContent=e,a.appendChild(t)}))}function populateGunguSelect(e){const a=document.getElementById("gunguSelect");a.innerHTML='<option value="">전체</option>',e&&rawData[e]&&Object.keys(rawData[e]).forEach((e=>{const t=document.createElement("option");t.value=e,t.textContent=e,a.appendChild(t)}))}function filterBySidoAndGungu(){const e=document.getElementById("sidoSelect").value,a=document.getElementById("gunguSelect").value;let t=[];if(e){const n=rawData[e];t=a?n[a]:Object.values(n).flat()}else t=flattenData(rawData);initializeGrid(t)}function updateLocalStorage(e){const{rowKey:a,columnName:t,value:n}=e,i=grid.getRow(a),s=JSON.parse(localStorage.getItem("adminData"));for(const e in s)for(const a in s[e]){const l=s[e][a].find((e=>e["읍면동"]===i["읍면동"]));if(l)return l[t]=n,void localStorage.setItem("adminData",JSON.stringify(s))}}function handleSelectionChange(){const e=grid.getCheckedRows();if(e.length>2){showToast("two-compare","warning",lang);const a=e.length-1;grid.uncheck(e[a].rowKey)}else displayDetailPanels(e),displayComparisonPanel(e)}function displayDetailPanels(e){const a=document.getElementById("detailPanelLeft"),t=document.getElementById("detailPanelRight"),n=document.getElementById("detailContentLeft"),i=document.getElementById("detailContentRight");e.length>0?(a.style.display="block",n.innerHTML=`\n            <div>\n                <h3>${e[0].읍면동}</h3>\n                <p><i class="fas fa-envelope"></i> 우편번호: ${e[0].우편번호}</p>\n                <p><i class="fas fa-map-marker-alt"></i> 위도: ${e[0].위도}</p>\n                <p><i class="fas fa-map-marker-alt"></i> 경도: ${e[0].경도}</p>\n                <p><i class="fas fa-prescription-bottle-alt"></i> 약국수: ${e[0].약국수}</p>\n                <p><i class="fas fa-hospital"></i> 병의원수: ${e[0].병의원수}</p>\n                <p><i class="fas fa-school"></i> 학교수: ${e[0].학교수}</p>\n                <p><i class="fas fa-parking"></i> 주차장수: ${e[0].주차장수}</p>\n                <p><i class="fas fa-users"></i> 주민수: ${e[0].주민수}</p>\n                <p><i class="fas fa-store"></i> 상점수: ${e[0].상점수}</p>\n                <p><i class="fas fa-tree"></i> 공원수: ${e[0].공원수}</p>\n                <p><i class="fas fa-book"></i> 도서관수: ${e[0].도서관수}</p>\n                <p><i class="fas fa-bus"></i> 버스정류장수: ${e[0].버스정류장수}</p>\n                <p><i class="fas fa-subway"></i> 지하철역수: ${e[0].지하철역수}</p>\n                <p><i class="fas fa-utensils"></i> 음식점수: ${e[0].음식점수}</p>\n                <p><i class="fas fa-dumbbell"></i> 체육시설수: ${e[0].체육시설수}</p>\n                <p><i class="fas fa-theater-masks"></i> 문화시설수: ${e[0].문화시설수}</p>\n                <p><i class="fas fa-landmark"></i> 관광명소수: ${e[0].관광명소수}</p>\n                <p><i class="fas fa-home"></i> 주택수: ${e[0].주택수}</p>\n                <p>입력일자: ${e[0].입력일자}</p>\n                <p>수정일자: ${e[0].수정일자}</p>\n            </div>\n        `,2==e.length?(t.style.display="block",i.innerHTML=`\n                <div>\n                    <h3>${e[1].읍면동}</h3>\n                    <p>우편번호: ${e[1].우편번호}</p>\n                    <p><i class="fas fa-map-marker-alt"></i> 위도: ${e[1].위도}</p>\n                    <p><i class="fas fa-map-marker-alt"></i> 경도: ${e[1].경도}</p>\n                    <p><i class="fas fa-prescription-bottle-alt"></i> 약국수: ${e[1].약국수}</p>\n                    <p><i class="fas fa-hospital"></i> 병의원수: ${e[1].병의원수}</p>\n                    <p><i class="fas fa-school"></i> 학교수: ${e[1].학교수}</p>\n                    <p><i class="fas fa-parking"></i> 주차장수: ${e[1].주차장수}</p>\n                    <p><i class="fas fa-users"></i> 주민수: ${e[1].주민수}</p>\n                    <p><i class="fas fa-store"></i> 상점수: ${e[1].상점수}</p>\n                    <p><i class="fas fa-tree"></i> 공원수: ${e[1].공원수}</p>\n                    <p><i class="fas fa-book"></i> 도서관수: ${e[1].도서관수}</p>\n                    <p><i class="fas fa-bus"></i> 버스정류장수: ${e[1].버스정류장수}</p>\n                    <p><i class="fas fa-subway"></i> 지하철역수: ${e[1].지하철역수}</p>\n                    <p><i class="fas fa-utensils"></i> 음식점수: ${e[1].음식점수}</p>\n                    <p><i class="fas fa-dumbbell"></i> 체육시설수: ${e[1].체육시설수}</p>\n                    <p><i class="fas fa-theater-masks"></i> 문화시설수: ${e[1].문화시설수}</p>\n                    <p><i class="fas fa-landmark"></i> 관광명소수: ${e[1].관광명소수}</p>\n                    <p><i class="fas fa-home"></i> 주택수: ${e[1].주택수}</p>\n                    <p>입력일자: ${e[1].입력일자}</p>\n                    <p>수정일자: ${e[1].수정일자}</p>\n                </div>\n            `):t.style.display="none"):(a.style.display="none",t.style.display="none")}function displayComparisonPanel(e){const a=document.getElementById("comparisonPanel"),t=document.getElementById("comparisonContent");if(2===e.length){const[n,i]=e,s=calculateDistance(n.위도,n.경도,i.위도,i.경도);a.style.display="block",t.innerHTML=`\n            <div>\n                <h3>거리 및 교통수단</h3>\n                <p>${n.읍면동} - ${i.읍면동}</p>\n                <p class="p-info">거리: ${s.toFixed(2)} km</p>\n                <p>교통수단: 버스, 지하철</p>\n            </div>\n            <div>\n                <h3>충전소 위치</h3>\n                <p>${n.읍면동} 충전소: 5개</p>\n                <p>${i.읍면동} 충전소: 3개</p>\n            </div>\n            <div>\n                <h3>전기차 충전소 위치</h3>\n                <p>${n.읍면동} 전기차 충전소: 2개</p>\n                <p>${i.읍면동} 전기차 충전소: 1개</p>\n            </div>\n        `}else a.style.display="none"}function calculateDistance(e,a,t,n){const i=toRadians(t-e),s=toRadians(n-a),l=Math.sin(i/2)*Math.sin(i/2)+Math.cos(toRadians(e))*Math.cos(toRadians(t))*Math.sin(s/2)*Math.sin(s/2);return 6371*(2*Math.atan2(Math.sqrt(l),Math.sqrt(1-l)))}function toRadians(e){return e*(Math.PI/180)}window.onload=function(){const e=document.getElementById("workarea");e.classList.add("mb-4","mt-4"),e.appendChild(searchButton),fetchDataAndInitialize(),document.getElementById("sidoSelect").addEventListener("change",(function(){populateGunguSelect(this.value)})),searchButton.addEventListener("click",filterBySidoAndGungu)};