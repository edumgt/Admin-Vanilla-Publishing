import{createAddButton}from"./common.js";const monthYear=document.getElementById("monthYear"),dates=document.getElementById("dates"),prevMonth=document.getElementById("prevMonth"),nextMonth=document.getElementById("nextMonth");createModal3("modalSt","수강생 목록",'<div class="bg-white p-8 rounded-lg shadow-sm w-1/2 max-h-full overflow-y-auto">\n                <h3 class="text-xl font-bold mb-4">수강생 목록</h3>\n                <ul id="studentList" class="list-disc pl-5"></ul>\n                <div class="flex justify-end mt-4">\n                    <button id="closeModal2" class="bg-gray-500 text-white">닫기</button>\n                </div>\n            </div>',[]);const modal=document.getElementById("modalLecture"),modalSt=document.getElementById("modalSt"),lectureForm=document.getElementById("lectureForm"),timeInput=document.getElementById("time"),courseInput=document.getElementById("course"),instructorInput=document.getElementById("instructor"),closeModal=document.getElementById("closeModal"),closeModal2=document.getElementById("closeModal2"),addStudentBtn=document.getElementById("addStudentBtn"),studentsContainer=document.getElementById("studentsContainer"),studentList=document.getElementById("studentList");let current=new Date,selectedDate="",selectedLecture=null;function renderCalendar(e){dates.innerHTML="";const t=current.getFullYear(),n=current.getMonth(),a=new Date(t,n,1).getDay(),d=new Date(t,n+1,0).getDate();monthYear.textContent=`${t}년 ${n+1}월`;const s=new Date,l=`${s.getFullYear()}-${String(s.getMonth()+1).padStart(2,"0")}-${String(s.getDate()).padStart(2,"0")}`;for(let e=0;e<a;e++)dates.innerHTML+='<div class="date"></div>';for(let a=1;a<=d;a++){const d=document.createElement("div");d.classList.add("date","border","border-gray-300","p-2","flex","flex-col","items-start");const s=`${t}-${String(n+1).padStart(2,"0")}-${String(a).padStart(2,"0")}`;d.setAttribute("data-date",s),d.ondrop=drop,d.ondragover=allowDrop,s===l&&d.classList.add("bg-gray-100","font-bold");const r=document.createElement("span");r.classList.add("date-number"),r.textContent=a,d.appendChild(r);const o=createAddButton();o.addEventListener("click",(function(){openModal(s)})),d.appendChild(o);const c=e.lectures.find((e=>e.date===s));if(c){const e=document.createElement("ul");e.classList.add("list-none","p-0","w-full","overflow-y-auto","max-h-80"),c.schedule.forEach(((t,n)=>{const a=document.createElement("li");a.classList.add("bg-gray-100","m-1","p-1","border","border-gray-200","text-sm","relative","cursor-move"),a.setAttribute("draggable","true"),a.ondragstart=drag,a.ondragend=endDrag,a.onclick=()=>showModal(t.students,t),a.setAttribute("data-date",s),a.setAttribute("data-index",n),a.textContent=`${t.time}: ${t.course} by ${t.instructor}`;const d=document.createElement("span");if(d.classList.add("custom-drag-icon"),d.innerHTML="☰",t.pastDate){const e=document.createElement("div");e.classList.add("past-date"),e.textContent=`이동 이전 날짜: ${t.pastDate}`,a.appendChild(e)}e.appendChild(a),a.appendChild(d)})),d.appendChild(e)}dates.appendChild(d)}}function allowDrop(e){e.preventDefault()}function drag(e){e.dataTransfer.setData("text",e.target.getAttribute("data-date")+","+e.target.getAttribute("data-index")),e.target.classList.add("draggable")}function endDrag(e){e.target.classList.remove("draggable")}function drop(e){e.preventDefault();const t=e.dataTransfer.getData("text").split(","),n=t[0],a=parseInt(t[1],10),d=e.target.closest(".date").getAttribute("data-date");if(n===d)return;let s=JSON.parse(localStorage.getItem("lecturesData"));if(!s)return;const l=s.lectures.find((e=>e.date===n)),r=s.lectures.find((e=>e.date===d))||{date:d,schedule:[]},o=l.schedule.splice(a,1)[0];o.pastDate=n,r.schedule.push(o),s.lectures.find((e=>e.date===d))||s.lectures.push(r),localStorage.setItem("lecturesData",JSON.stringify(s)),renderCalendar(s)}function openModal(e){selectedDate=e,modal.classList.remove("hidden")}function closeModalFunc(){modal.classList.add("hidden")}function closeModalFunc2(){modalSt.classList.add("hidden")}function showModal(e,t){studentList.innerHTML="",e&&e.length>0?(e.forEach((e=>{const t=document.createElement("li");t.textContent=`${e.name}, ${e.university}, ${e.year} year, Major: ${e.major}`,studentList.appendChild(t)})),modalSt.classList.remove("hidden")):(selectedLecture=t,modal.classList.remove("hidden"))}function fetchData(){let e=JSON.parse(localStorage.getItem("lecturesData"));e?renderCalendar(e):fetch("assets/mock/lectures.json").then((e=>e.json())).then((e=>{localStorage.setItem("lecturesData",JSON.stringify(e)),renderCalendar(e)})).catch((e=>console.error("Error fetching data:",e)))}lectureForm.addEventListener("submit",(e=>{e.preventDefault();const t=timeInput.value,n=courseInput.value,a=instructorInput.value,d=[];if(document.querySelectorAll(".student-entry").forEach((e=>{const t=e.querySelector(".student-name").value,n=e.querySelector(".student-university").value,a=e.querySelector(".student-year").value,s=e.querySelector(".student-major").value;t&&n&&a&&s&&d.push({name:t,university:n,year:parseInt(a,10),major:s})})),!t||!n||!a)return void showToast("required-input","warning",lang);let s=JSON.parse(localStorage.getItem("lecturesData"))||{lectures:[]},l=s.lectures.find((e=>e.date===selectedDate));l||(l={date:selectedDate,schedule:[]},s.lectures.push(l)),l.schedule.push({time:t,course:n,instructor:a,students:d}),localStorage.setItem("lecturesData",JSON.stringify(s)),renderCalendar(s),closeModalFunc()})),closeModal.addEventListener("click",closeModalFunc),closeModal2.addEventListener("click",closeModalFunc2),addStudentBtn.addEventListener("click",(()=>{const e=document.createElement("div");e.classList.add("student-entry","mb-2"),e.innerHTML='\n            <label class="block mb-1">학생명:</label>\n            <input type="text" class="student-name block mb-4">\n            <label class="block mb-1">학교:</label>\n            <input type="text" class="student-university block mb-4">\n            <label class="block mb-1">입학년도:</label>\n            <input type="number" class="student-year block mb-4">\n            <label class="block mb-1">전공(과):</label>\n            <input type="text" class="student-major block mb-4">\n        ',studentsContainer.appendChild(e)})),prevMonth.addEventListener("click",(()=>{current.setMonth(current.getMonth()-1),fetchData()})),nextMonth.addEventListener("click",(()=>{current.setMonth(current.getMonth()+1),fetchData()})),fetchData();