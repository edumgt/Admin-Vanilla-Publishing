<!DOCTYPE html>
<html>

<head>
    <link href="assets/css/trello.css" rel="stylesheet">
    <link href="assets/css/network.css" rel="stylesheet">
</head>

<body>
    <div class="gnb-menu">
        <ul class="flex">
            <div id="logo"></div>
            <div id="tabs-container"></div>
            <div id="dropdown-container"></div>
            <div id="memberIcon"></div>
        </ul>
    </div>
    <div id="toast-container"></div>
    <div id="offCanvasContainer"></div>

    <div id="content">
        <nav class="breadcrumb"></nav>

        <div id="workarea">

            <div class="w-1/4 border-t border-gray-100">

                <form id="consultationForm" class="bg-white shadow-md rounded px-8 pt-6 pb-8 mb-4">
                    <div class="mb-4 relative">
                        <label class="block mb-1" for="customerName">ê³ ê°ëª…:</label>
                        <div class="relative w-full">
                            <input class="w-full p-2 pr-10 outline-none border rounded" 
                            id="customerName" type="text" placeholder="Customer Name">
                            <button id="searchButton" class="absolute right-2 top-1/2 transform -translate-y-1/2 text-gray-500">
                                ğŸ”
                            </button>
                        </div>
                    
                        <!-- ëª¨ë‹¬ì„ customerName ë°”ë¡œ ì•„ë˜ì— í‘œì‹œ -->
                        <div id="searchModal" class="absolute left-0 w-full bg-white border rounded shadow-lg hidden z-50 p-4">
                            <h2 class="text-lg font-semibold mb-2">ì˜ˆì•½ì ì°¾ê¸°</h2>
                            <input type="text" id="searchInput" class="w-full p-2 border rounded mb-2" placeholder="ì´ë¦„ ê²€ìƒ‰">
                            <div id="searchResults" class="border rounded p-2 bg-white max-h-48 overflow-y-auto"></div>
                            <button id="closeModal" class="mt-2 px-4 py-2 bg-gray-500 text-white rounded w-full">ë‹«ê¸°</button>
                        </div>
                    </div>
                    
                    <script>
                        document.getElementById('searchButton').addEventListener('click', (event) => {
                            event.stopPropagation();
                            const modal = document.getElementById('searchModal');
                            const inputBox = document.getElementById('customerName');
                    
                            // ëª¨ë‹¬ì„ customerName ì…ë ¥ í•„ë“œ ì•„ë˜ì— ë°°ì¹˜
                            const rect = inputBox.getBoundingClientRect();
                            modal.style.top = `${rect.bottom + window.scrollY}px`;
                            modal.style.left = `${rect.left}px`;
                            modal.style.width = `${rect.width}px`;
                    
                            modal.classList.remove('hidden');
                            document.getElementById('searchInput').focus();
                        });
                    
                        document.getElementById('closeModal').addEventListener('click', () => {
                            document.getElementById('searchModal').classList.add('hidden');
                        });
                    
                        document.getElementById('searchInput').addEventListener('input', async () => {
                            const searchResults = document.getElementById('searchResults');
                            const query = document.getElementById('searchInput').value.trim().toLowerCase();
                    
                            searchResults.innerHTML = '';
                    
                            if (!query) return; // ë¹ˆ ì…ë ¥ì¼ ê²½ìš° ì²˜ë¦¬í•˜ì§€ ì•ŠìŒ
                    
                            try {
                                const response = await fetch('assets/mock/reservations.json'); // JSON ê²½ë¡œ í™•ì¸ í•„ìš”
                                const data = await response.json();
                    
                                if (!data.reservations) {
                                    console.error("JSON ë°ì´í„° êµ¬ì¡°ê°€ ì˜¬ë°”ë¥´ì§€ ì•ŠìŠµë‹ˆë‹¤.");
                                    return;
                                }
                    
                                // í•„í„°ë§ (ëŒ€ì†Œë¬¸ì êµ¬ë¶„ ì—†ì´ ê²€ìƒ‰)
                                const filtered = data.reservations.filter(reservation =>
                                    reservation.name.toLowerCase().includes(query)
                                );
                    
                                if (filtered.length > 0) {
                                    filtered.forEach(reservation => {
                                        const div = document.createElement('div');
                                        div.classList.add('p-2', 'cursor-pointer', 'hover:bg-gray-200');
                                        div.textContent = reservation.name;
                                        div.setAttribute('data-name', reservation.name); // ê°’ ì €ì¥
                                        searchResults.appendChild(div);
                                    });
                                } else {
                                    searchResults.innerHTML = `<div class="p-2 text-gray-500">ê²€ìƒ‰ ê²°ê³¼ ì—†ìŒ</div>`;
                                }
                            } catch (error) {
                                console.error("ê²€ìƒ‰ ì¤‘ ì˜¤ë¥˜ ë°œìƒ:", error);
                            }
                        });
                    
                        // ë™ì  ê²€ìƒ‰ ê²°ê³¼ í´ë¦­ ì‹œ ì´ë²¤íŠ¸ ì²˜ë¦¬ (Event Delegation)
                        document.getElementById('searchResults').addEventListener('click', (event) => {
                            const selectedName = event.target.getAttribute('data-name');
                            if (selectedName) {
                                document.getElementById('customerName').value = selectedName;
                                document.getElementById('searchModal').classList.add('hidden');
                            }
                        });
                    
                        // ëª¨ë‹¬ ì™¸ë¶€ í´ë¦­ ì‹œ ë‹«ê¸°
                        document.addEventListener('click', (event) => {
                            const modal = document.getElementById('searchModal');
                            const searchButton = document.getElementById('searchButton');
                            const customerName = document.getElementById('customerName');
                    
                            if (!modal.contains(event.target) && event.target !== searchButton && event.target !== customerName) {
                                modal.classList.add('hidden');
                            }
                        });
                    </script>
                    
                    
                    
                    
                    <div class="mb-4">
                        <label class="block mb-1" for="log">ìƒë‹´ë‚´ìš©:</label>
                        <textarea class=" rounded w-full    " id="log"
                            placeholder="Describe the consultation..." ></textarea>
                    </div>
                    <div class="mb-4">
                        <label class="block mb-1" for="solution">ì œì•ˆì‚¬í•­:</label>
                        <textarea class=" rounded w-full    "
                            id="solution" placeholder="Proposed solution..." ></textarea>
                    </div>
                    <div class="flex items-center justify-between">
                        <button class="bg-blue-500 text-white" type="submit">ë‹´ë‹¹ì ì§€ì •</button>
                    </div>
                </form>

                <div id="consultantList" class="bg-gray-200 p-4 overflow-x-auto flex flex-wrap"></div>
            </div>


            <div class="w-3/4 px-4">

                <div class="flex justify-between items-center ">
                    <label for="sortOptions">&nbsp;</label>
                    <select id="sortOptions">
                        <option value="customerName">Customer Name</option>
                        <option value="date">Date</option>
                        <option value="consultant">Consultant</option>
                    </select>
                </div>
                <div id="processFlow" class="mt-2 flex flex-wrap "></div>
            </div>
        </div>


        <div id="modal"
            class="hidden fixed top-0 left-0 w-full h-full bg-black bg-opacity-50 flex items-center justify-center z-50">
            <div class="modal-content">
                <div class="mb-4">ìƒíƒœë³„ ë©”ëª¨</div>
                <textarea id="reasonInput"
                    class=" appearance-none border rounded w-full h-full py-2 px-3 text-gray-700   "
                    placeholder="ìƒíƒœì— ëŒ€í•œ ë‚´ì—­ì„ ì…ë ¥í•˜ì„¸ìš”"></textarea>
                <div class="flex items-center justify-between mt-4">
                    <button id="saveReason" class="bg-blue-500 text-white">ì €ì¥</button>
                    <button id="closeModalTopRight" class="text-gray-600 hover:text-gray-800 text-lg">
                        &times;
                    </button>
                </div>
            </div>
        </div>


    </div>
    <div id="buttonContainer"></div>
    <div id="appContainer"></div>
    <script type="text/javascript" src="assets/js/logo.js"></script>
    <script type="text/javascript" src="assets/js/configframe.js"></script>
    <script type="text/javascript" src="assets/js/consultation.js"></script>
    <script type="text/javascript" src="assets/js/dropdown.js"></script>
    
</body>

</html>